Directory structure:
‚îî‚îÄ‚îÄ janusinss-mp/
    ‚îú‚îÄ‚îÄ README.txt
    ‚îú‚îÄ‚îÄ about.php
    ‚îú‚îÄ‚îÄ add_product.php
    ‚îú‚îÄ‚îÄ add_to_cart.php
    ‚îú‚îÄ‚îÄ admin.php
    ‚îú‚îÄ‚îÄ admin_router.php
    ‚îú‚îÄ‚îÄ cart.php
    ‚îú‚îÄ‚îÄ checkout.php
    ‚îú‚îÄ‚îÄ contact.php
    ‚îú‚îÄ‚îÄ db.php
    ‚îú‚îÄ‚îÄ debug_log.txt
    ‚îú‚îÄ‚îÄ delete_product.php
    ‚îú‚îÄ‚îÄ delete_review.php
    ‚îú‚îÄ‚îÄ delete_user.php
    ‚îú‚îÄ‚îÄ edit_product.php
    ‚îú‚îÄ‚îÄ export_orders.php
    ‚îú‚îÄ‚îÄ farmers.php
    ‚îú‚îÄ‚îÄ fetch_products.php
    ‚îú‚îÄ‚îÄ fix_database.php
    ‚îú‚îÄ‚îÄ grocery_db.sql
    ‚îú‚îÄ‚îÄ index.php
    ‚îú‚îÄ‚îÄ login.php
    ‚îú‚îÄ‚îÄ logout.php
    ‚îú‚îÄ‚îÄ my_orders.php
    ‚îú‚îÄ‚îÄ order_details.php
    ‚îú‚îÄ‚îÄ place_order.php
    ‚îú‚îÄ‚îÄ privacy_policy.php
    ‚îú‚îÄ‚îÄ product.php
    ‚îú‚îÄ‚îÄ profile.php
    ‚îú‚îÄ‚îÄ remove_from_cart.php
    ‚îú‚îÄ‚îÄ success.php
    ‚îú‚îÄ‚îÄ sustainability.php
    ‚îú‚îÄ‚îÄ terms_of_service.php
    ‚îú‚îÄ‚îÄ update_cart.php
    ‚îú‚îÄ‚îÄ user_cancel_order.php
    ‚îú‚îÄ‚îÄ user_login.php
    ‚îú‚îÄ‚îÄ user_logout.php
    ‚îú‚îÄ‚îÄ user_order_details.php
    ‚îú‚îÄ‚îÄ user_register.php
    ‚îî‚îÄ‚îÄ includes/
        ‚îú‚îÄ‚îÄ footer.php
        ‚îî‚îÄ‚îÄ header.php

================================================
FILE: README.txt
================================================
Project: FreshCart Market (Grocery E-Commerce)
Student Name: Janus Dominic
Date: November 2025

==========================
INSTALLATION INSTRUCTIONS
==========================
1. Copy the project folder to your XAMPP 'htdocs' directory.
2. Start XAMPP (Apache and MySQL).
3. Open your browser and go to 'http://localhost/phpmyadmin'.
4. Create a new database named 'grocery_db'.
5. Click 'Import', choose the file 'grocery_db.sql' from this project folder, and click 'Go'.
6. Open your browser and go to 'http://localhost/your_project_folder/'.

==========================
ADMIN ACCOUNT
==========================
To access the Admin Panel:
URL: http://localhost/your_project_folder/admin.php
Username: admin
Password: admin123

==========================
FEATURES
==========================
- Browse Products with Live Stock Count.
- Add to Cart & Remove Items.
- Checkout System with Order Processing.
- Admin Dashboard to View Orders.
- Admin Inventory Management (Update Stock/Price).


================================================
FILE: about.php
================================================
<?php include 'db.php'; ?>
<?php include 'includes/header.php'; ?>

<section class="page-header">
    <div class="container">
        <h1 class="page-title animate-fade-in">Our Roots</h1>
        <p class="page-subtitle">We believe in a food system that values quality, transparency, and the people who grow it.</p>
    </div>
</section>

<div class="container mb-5">
    <div class="row align-items-center mb-5">
        <div class="col-lg-6">
            <img src="https://images.unsplash.com/photo-1542838132-92c53300491e?auto=format&fit=crop&q=80&w=1000" class="img-fluid rounded-4 shadow-sm" alt="Market">
        </div>
        <div class="col-lg-6 ps-lg-5">
            <h2 class="mb-3" style="font-family: var(--font-serif);">From Soil to Soul.</h2>
            <p class="text-muted lead">FreshCart started with a simple idea: good food shouldn't be hard to find.</p>
            <p class="text-muted">We partner directly with local farmers to bring you produce that was in the ground just yesterday. No warehouses, no long transit times‚Äîjust fresh, honest food.</p>
        </div>
    </div>

    <div class="row g-4 mt-5">
        <div class="col-md-4">
            <div class="value-card">
                <div class="value-icon"><i class="bi bi-heart"></i></div>
                <h4>Passion</h4>
                <p class="text-muted">We love food, and we love the people who grow it.</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="value-card">
                <div class="value-icon"><i class="bi bi-shield-check"></i></div>
                <h4>Integrity</h4>
                <p class="text-muted">100% Organic certified. No hidden preservatives.</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="value-card">
                <div class="value-icon"><i class="bi bi-people"></i></div>
                <h4>Community</h4>
                <p class="text-muted">Supporting local economies with every purchase.</p>
            </div>
        </div>
    </div>
</div>

<?php include 'includes/footer.php'; ?>


================================================
FILE: add_product.php
================================================
<?php
include 'db.php';
session_start();

// Security Check
if (!isset($_SESSION['admin_logged_in']) || $_SESSION['admin_logged_in'] !== true) {
    header("Location: login.php");
    exit;
}

// Handle Form Submission
if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    $name = $_POST['name'];
    $category = $_POST['category'];
    $price = $_POST['price'];
    $stock = $_POST['stock_qty'];
    
    // IMAGE UPLOAD LOGIC
    $image = "default.jpg"; // Default
    
    if (isset($_FILES['image']) && $_FILES['image']['error'] == 0) {
        // 1. Check MIME Type (Real Check)
        $check = getimagesize($_FILES["image"]["tmp_name"]);
        if($check === false) {
            die("File is not an image.");
        }

        // 2. Check Extension (Secondary Check)
        $allowed_types = ['jpg', 'jpeg', 'png', 'gif'];
        if (!in_array(strtolower($file_extension), $allowed_types)) {
            die("Sorry, only JPG, JPEG, PNG & GIF files are allowed.");
        }

        $target_dir = "assets/images/";
        $file_extension = pathinfo($_FILES["image"]["name"], PATHINFO_EXTENSION);
        $new_filename = uniqid() . "." . $file_extension;
        $target_file = $target_dir . $new_filename;
        
        if (in_array(strtolower($file_extension), $allowed_types)) {
            if (move_uploaded_file($_FILES["image"]["tmp_name"], $target_file)) {
                $image = $new_filename;
            }
        }
    }

    // Insert into Database
    $sql = "INSERT INTO products (name, category, price, stock_qty, image) VALUES (?, ?, ?, ?, ?)";
    $stmt = $pdo->prepare($sql);
    $stmt->execute([$name, $category, $price, $stock, $image]);

    // Redirect to Product List
    header("Location: admin.php"); // Updated redirect to main admin
    exit;
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Add New Product | Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
</head>
<body style="background-color: var(--bg-color);">
    
    <div class="form-card-wrapper animate-fade-in">
        <div class="form-card">
            
            <h2 class="form-header-title">Create Product</h2>
            <p class="form-header-subtitle">Add a new item to your FreshCart inventory.</p>

            <form method="POST" enctype="multipart/form-data">
                
                <div class="form-group-modern">
                    <label class="label-modern">Product Image</label>
                    
                    <div class="upload-area-modern" id="uploadPreview">
                        
                        <div id="uploadPlaceholder">
                            <div class="upload-icon-circle">
                                <i class="bi bi-cloud-arrow-up"></i>
                            </div>
                            <h6 class="mb-1 text-dark">Click to upload image</h6>
                            <p class="text-muted small mb-0">SVG, PNG, JPG or GIF (Max 2MB)</p>
                        </div>

                        <input type="file" name="image" id="imageInput" class="file-input-hidden" accept="image/*" required>
                    </div>
                </div>

                <div class="form-group-modern">
                    <label class="label-modern">Product Name</label>
                    <input type="text" name="name" class="input-modern" placeholder="e.g. Organic Bananas" required>
                </div>

                <div class="row">
                    <div class="col-md-12 form-group-modern">
                        <label class="label-modern">Category</label>
                        <select name="category" class="input-modern">
                            <option value="" disabled selected>Select Category...</option>
                            <option value="Fruits">Fruits</option>
                            <option value="Vegetables">Vegetables</option>
                            <option value="Dairy">Dairy</option>
                            <option value="Bakery">Bakery</option>
                            <option value="Beverages">Beverages</option>
                            <option value="General">General</option>
                            <option value="Pantry">Pantry</option>
                            <option value="Meat">Meat</option>
                            <option value="Snacks">Snacks</option>
                        </select>
                    </div>
                </div>

                <div class="row">

                    <div class="col-md-6 form-group-modern">
                        <label class="label-modern">Price ($)</label>
                        <input type="number" step="0.01" name="price" class="input-modern" placeholder="0.00" required>
                    </div>
                    <div class="col-md-6 form-group-modern">
                        <label class="label-modern">Stock Quantity</label>
                        <input type="number" name="stock_qty" class="input-modern" placeholder="100" required>
                    </div>
                </div>

                <button type="submit" class="btn-create">Publish Product</button>
                <a href="admin.php" class="btn-cancel-link">Cancel</a>

            </form>
        </div>
    </div>


<script>
    // Image Preview Logic for Add Product
    const imageInput = document.getElementById('imageInput');
    const uploadPreview = document.getElementById('uploadPreview');
    const placeholder = document.getElementById('uploadPlaceholder');

    imageInput.addEventListener('change', function() {
        const file = this.files[0];
        
        if (file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                // 1. Create the image element
                const img = document.createElement('img');
                img.src = e.target.result;
                // Styling to make it look good inside the box
                img.style.width = '100%';
                img.style.height = '220px'; // Slightly shorter to make room for text
                img.style.objectFit = 'contain';
                img.style.borderRadius = '12px';
                img.style.mixBlendMode = 'multiply'; // Blends white backgrounds

                // 2. Create the "Change Image" label
                const changeLabel = document.createElement('p');
                changeLabel.innerText = "Click here to change image";
                changeLabel.className = "text-muted small mt-3 mb-0 fw-bold text-uppercase";
                changeLabel.style.letterSpacing = "0.05em";

                // 3. Clear the original placeholder text/icon
                uploadPreview.innerHTML = ''; 

                // 4. Rebuild the container content
                uploadPreview.appendChild(imageInput); // IMPORTANT: Keep the hidden input!
                uploadPreview.appendChild(img);        // Add the preview image
                uploadPreview.appendChild(changeLabel);// Add the text below it
            }
            
            reader.readAsDataURL(file);
        }
    });
</script>

</body>
</html>


================================================
FILE: add_to_cart.php
================================================
<?php
error_reporting(0); // Suppress warnings for clean JSON output
session_start();
include 'db.php';

$response = ['status' => 'error', 'message' => 'Invalid request'];

// 1. SECURITY CHECK: Must be logged in
if (!isset($_SESSION['user_id'])) {
    echo json_encode(['status' => 'login_required', 'message' => 'Please login first.']);
    exit;
}

if (isset($_POST['product_id'])) {
    $productId = $_POST['product_id'];
    $qtyRequested = 1; // Default add quantity

    try {
        // 2. STOCK CHECK (The Fix)
        // Fetch current stock from DB
        $stmt = $pdo->prepare("SELECT stock_qty, name FROM products WHERE id = ?");
        $stmt->execute([$productId]);
        $product = $stmt->fetch(PDO::FETCH_ASSOC);

        if (!$product) {
            echo json_encode(['status' => 'error', 'message' => 'Product not found.']);
            exit;
        }

        // Initialize cart if missing
        if (!isset($_SESSION['cart'])) {
            $_SESSION['cart'] = [];
        }

        // Check how many we already have in the cart
        $currentCartQty = isset($_SESSION['cart'][$productId]) ? $_SESSION['cart'][$productId] : 0;
        $newTotalQty = $currentCartQty + $qtyRequested;

        // 3. VALIDATE QUANTITY
        if ($newTotalQty <= $product['stock_qty']) {
            // Add/Increment item
            if (isset($_SESSION['cart'][$productId])) {
                $_SESSION['cart'][$productId]++;
            } else {
                $_SESSION['cart'][$productId] = 1;
            }

            // Calculate total items for badge
            $totalItems = array_sum($_SESSION['cart']);

            $response = [
                'status' => 'success',
                'cart_count' => $totalItems,
                'message' => 'Item added to cart!'
            ];
        } else {
            // Not enough stock
            $response = [
                'status' => 'error', 
                'message' => "Sorry, only {$product['stock_qty']} items left in stock!"
            ];
        }

    } catch (Exception $e) {
        $response = ['status' => 'error', 'message' => 'Database error.'];
    }
}

// Return JSON
header('Content-Type: application/json');
echo json_encode($response);
exit;
?>


================================================
FILE: admin.php
================================================
<?php
include 'db.php';
session_start();

if (!isset($_SESSION['admin_logged_in']) || $_SESSION['admin_logged_in'] !== true) {
    header("Location: login.php");
    exit;
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <title>FreshCart Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css?v=<?php echo time(); ?>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    
    <?php if (isset($_GET['msg']) && $_GET['msg'] == 'updated'): ?>
    <div class="success-overlay" id="successModal">
        <div class="success-modal">
            <div class="success-icon-animated">
                <i class="bi bi-check-lg"></i>
            </div>
            <h2 class="success-title">Perfect!</h2>
            <p class="success-desc">The product has been updated successfully.</p>
            <button onclick="closeModal()" class="btn-success-action">Awesome</button>
        </div>
    </div>
    <script>
        function closeModal() {
            document.getElementById('successModal').style.display = 'none';
            // Clean URL while keeping the current view
            const urlParams = new URLSearchParams(window.location.search);
            const view = urlParams.get('view') || 'dashboard';
            window.history.replaceState({}, document.title, 'admin.php?view=' + view);
        }
    </script>
    <?php endif; ?>

    <div class="admin-wrapper">
        
        <div class="admin-sidebar">
            <div class="mb-4">
                <div class="admin-brand">FreshCart<span>.</span></div>
                <span class="admin-badge">Admin Panel</span>
            </div>
            
            <nav class="nav flex-column gap-3 flex-grow-1">
                <a href="#" id="nav-dashboard" onclick="loadView('dashboard')" class="admin-nav-link active">
                    <i class="bi bi-grid-1x2-fill"></i> Overview
                </a>
                <a href="#" id="nav-orders" onclick="loadView('orders')" class="admin-nav-link">
                    <i class="bi bi-receipt-cutoff"></i> Orders
                </a>
                <a href="#" id="nav-products" onclick="loadView('products')" class="admin-nav-link">
                    <i class="bi bi-box-seam"></i> Inventory
                </a>
                <a href="#" id="nav-users" onclick="loadView('users')" class="admin-nav-link">
                    <i class="bi bi-people"></i> Customers
                </a>
                <a href="#" id="nav-reviews" onclick="loadView('reviews')" class="admin-nav-link">
                    <i class="bi bi-star"></i> Reviews
                </a>
            </nav>

            <div class="mt-auto border-top pt-4">
                <a href="index.php" class="admin-nav-link mb-1">
                    <i class="bi bi-shop-window"></i> Storefront
                </a>
                <a href="logout.php" class="admin-nav-link text-danger">
                    <i class="bi bi-box-arrow-left"></i> Logout
                </a>
            </div>
        </div>

        <main class="admin-main" id="mainContent">
            </main>

    </div>

<script>
        // Default Load - Check URL for 'view' parameter
        document.addEventListener("DOMContentLoaded", () => {
            const urlParams = new URLSearchParams(window.location.search);
            // If ?view=products exists, load that. Otherwise load 'dashboard'
            const currentView = urlParams.get('view') || 'dashboard';
            loadView(currentView);
        });

        function loadView(viewName) {
            // 1. Handle Sidebar Highlighting (Strip extra params like '&status=Pending')
            const baseView = viewName.split('&')[0]; 
            
            document.querySelectorAll('.admin-nav-link').forEach(el => el.classList.remove('active'));
            
            // Find the sidebar link by ID (nav-dashboard, nav-products, etc.)
            const activeLink = document.getElementById('nav-' + baseView);
            if (activeLink) {
                activeLink.classList.add('active');
            }

            const main = document.getElementById('mainContent');

            // 2. Fetch Content INSTANTLY
            fetch('admin_router.php?view=' + viewName)
                .then(response => response.text())
                .then(html => {
                    main.innerHTML = html;
                    
                    // Re-initialize Charts if any
                    const scripts = main.querySelectorAll("script");
                    scripts.forEach(oldScript => {
                        const newScript = document.createElement("script");
                        Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
                        newScript.appendChild(document.createTextNode(oldScript.innerHTML));
                        oldScript.parentNode.replaceChild(newScript, oldScript);
                    });
                })
                .catch(err => console.error('Error loading view:', err));
        }
    </script>

</body>
</html>


================================================
FILE: admin_router.php
================================================
<?php
include 'db.php';
session_start();

// Security Check
if (!isset($_SESSION['admin_logged_in']) || $_SESSION['admin_logged_in'] !== true) {
    echo "<script>window.location.href='login.php';</script>";
    exit;
}

$view = $_GET['view'] ?? 'dashboard';

// --- VIEW 1: DASHBOARD ---
if ($view == 'dashboard') {
    $stmt = $pdo->query("SELECT * FROM orders ORDER BY id DESC");
    $orders = $stmt->fetchAll(PDO::FETCH_ASSOC);

    $sqlChart = "SELECT DATE(created_at) as order_date, SUM(total_amount) as daily_total FROM orders WHERE status != 'Cancelled' GROUP BY DATE(created_at) ORDER BY order_date ASC LIMIT 7";
    $stmtChart = $pdo->query($sqlChart);
    $chartData = $stmtChart->fetchAll(PDO::FETCH_ASSOC);
    $dates = []; $totals = [];
    foreach ($chartData as $data) { $dates[] = date('M d', strtotime($data['order_date'])); $totals[] = $data['daily_total']; }

    $stmtLow = $pdo->query("SELECT * FROM products WHERE stock_qty <= 5");
    $lowStockItems = $stmtLow->fetchAll(PDO::FETCH_ASSOC);
    
    $totalRevenue = 0;
    $pendingOrders = 0;
    foreach($orders as $o) { 
        if($o['status'] != 'Cancelled') $totalRevenue += $o['total_amount'];
        if($o['status'] == 'Pending') $pendingOrders++;
    }
    ?>
    
    <div class="dash-welcome-banner">
        <div>
            <h2 class="dash-title">Dashboard Overview</h2>
            <p class="dash-subtitle mb-0">Here's what's happening with your store today.</p>
        </div>
        <a href="export_orders.php" class="btn-glass-white text-decoration-none">
            <i class="bi bi-download me-2"></i> Export Report
        </a>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="dash-stat-card interactive" onclick="loadView('orders')">
                <i class="bi bi-receipt dash-watermark-icon"></i>
                <span class="dash-stat-label">Total Orders</span>
                <div class="dash-stat-value"><?= count($orders) ?></div>
                <div class="mt-2 text-success small fw-bold"><i class="bi bi-arrow-right-circle"></i> View All</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="dash-stat-card">
                <i class="bi bi-currency-dollar dash-watermark-icon"></i>
                <span class="dash-stat-label">Total Revenue</span>
                <div class="dash-stat-value">$<?= number_format($totalRevenue, 2) ?></div>
                <div class="mt-2 text-success small fw-bold"><i class="bi bi-graph-up"></i> Trending Up</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="dash-stat-card interactive" style="border-left: 4px solid #ffc107;" onclick="loadView('orders&status=Pending')">
                <i class="bi bi-hourglass-split dash-watermark-icon"></i>
                <span class="dash-stat-label text-warning">Pending Actions</span>
                <div class="dash-stat-value"><?= $pendingOrders ?></div>
                <div class="mt-2 text-warning small fw-bold"><i class="bi bi-exclamation-circle"></i> Needs Attention</div>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-lg-8">
            <div class="dashboard-card h-100">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="font-serif m-0">Sales Analytics</h5>
                    <select class="form-select form-select-sm w-auto border-0 bg-light"><option>Last 7 Days</option></select>
                </div>
                <canvas id="salesChart" style="max-height: 300px;"></canvas>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="alert-card shadow-sm">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div class="d-flex align-items-center">
                        <div class="alert-header-icon me-3"><i class="bi bi-bell-fill"></i></div>
                        <div><h5 class="m-0 fw-bold text-dark font-serif">Low Stock</h5><small class="text-muted">Requires immediate attention</small></div>
                    </div>
                    <span class="badge bg-warning text-dark rounded-pill border border-warning px-3"><?= count($lowStockItems) ?> Items</span>
                </div>
                
                <?php if (count($lowStockItems) > 0): ?>
                    <div style="max-height: 280px; overflow-y: auto; padding: 2px;">
                        <?php foreach ($lowStockItems as $item): 
                            $qty = $item['stock_qty'];
                            $percent = ($qty == 0) ? 0 : min(100, ($qty / 10) * 100); 
                            $img = $item['image'] ? $item['image'] : 'default.jpg';
                        ?>
                            <a href="edit_product.php?id=<?= $item['id'] ?>" class="text-decoration-none text-reset">
                                <div class="stock-item-modern">
                                    <img src="assets/images/<?= $img ?>" class="stock-img" alt="img">
                                    <div class="stock-info">
                                        <span class="stock-name"><?= htmlspecialchars($item['name']) ?></span>
                                        <div class="stock-progress-bg"><div class="stock-progress-bar" style="width: <?= $percent ?>%; background: <?= $qty == 0 ? '#adb5bd' : '#dc3545' ?>;"></div></div>
                                    </div>
                                    <?php if ($qty == 0): ?>
                                        <div class="stock-badge-out"><i class="bi bi-x-lg" style="font-size: 0.9rem;"></i><span>No Stock</span></div>
                                    <?php else: ?>
                                        <div class="stock-badge-critical"><?= $qty ?><span>Left</span></div>
                                    <?php endif; ?>
                                </div>
                            </a>
                        <?php endforeach; ?>
                    </div>
                    <a href="#" onclick="loadView('products')" class="btn-restock-pulse mt-4 d-block text-decoration-none text-center">Manage Inventory <i class="bi bi-arrow-right ms-2"></i></a>
                <?php else: ?>
                    <div class="text-center py-5"><h6 class="fw-bold">All Good!</h6><p class="text-muted small">Inventory levels are healthy.</p></div>
                <?php endif; ?>
            </div>
        </div>
    </div>

    <script>
        if(window.salesChartInstance) window.salesChartInstance.destroy();
        var ctx = document.getElementById('salesChart').getContext('2d');
        window.salesChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: <?= json_encode($dates) ?>,
                datasets: [{
                    label: 'Revenue',
                    data: <?= json_encode($totals) ?>,
                    borderColor: '#5D866C',
                    backgroundColor: 'rgba(93, 134, 108, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
        });
    </script>
    <?php
}

// --- VIEW 2: PRODUCTS ---
elseif ($view == 'products') {
    $stmt = $pdo->query("SELECT * FROM products ORDER BY id DESC");
    $products = $stmt->fetchAll(PDO::FETCH_ASSOC);
    ?>
    <div class="inventory-header-card">
        <div>
            <h2 class="admin-header-title">Product Inventory</h2>
            <p class="text-muted m-0">Manage your catalog, stock levels, and pricing.</p>
        </div>
        <a href="add_product.php" class="btn-add-product text-decoration-none"><i class="bi bi-plus-circle-fill fs-5"></i> Add New Product</a>
    </div>
    <div class="inventory-table-container">
        <div class="table-responsive">
            <table class="table table-inventory mb-0">
                <thead><tr><th style="padding-left: 2rem;">Item</th><th>Price</th><th>Stock Status</th><th class="text-end" style="padding-right: 2rem;">Actions</th></tr></thead>
                <tbody>
                    <?php foreach ($products as $p): ?>
                    <tr>
                        <td style="padding-left: 2rem;">
                            <div class="d-flex align-items-center gap-3">
                                <div class="inv-img-box"><img src="assets/images/<?= $p['image'] ?: 'default.jpg' ?>" alt="img"></div>
                                <div><span class="inv-product-name"><?= htmlspecialchars($p['name']) ?></span><span class="inv-product-cat"><?= htmlspecialchars($p['category']) ?></span></div>
                            </div>
                        </td>
                        <td><span class="inv-price">$<?= number_format($p['price'], 2) ?></span></td>
                        <td>
                            <?php 
                                if($p['stock_qty'] == 0) echo '<div class="stock-status stock-out"><span class="stock-dot"></span> No Stock</div>';
                                elseif($p['stock_qty'] < 5) echo '<div class="stock-status stock-low"><span class="stock-dot"></span> Low Stock ('.$p['stock_qty'].')</div>';
                                else echo '<div class="stock-status stock-high"><span class="stock-dot"></span> In Stock ('.$p['stock_qty'].')</div>';
                            ?>
                        </td>
                        <td class="text-end" style="padding-right: 2rem;">
                            <a href="edit_product.php?id=<?= $p['id'] ?>" class="btn-icon-action" title="Edit"><i class="bi bi-pencil-fill" style="font-size: 0.9rem;"></i></a>
                            <a href="delete_product.php?id=<?= $p['id'] ?>" class="btn-icon-action btn-icon-delete" title="Delete" onclick="return confirm('Delete product?');"><i class="bi bi-trash-fill" style="font-size: 0.9rem;"></i></a>
                        </td>
                    </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    </div>
    <?php
}

// --- VIEW 3: CUSTOMERS ---
elseif ($view == 'users') {
    $stmt = $pdo->query("SELECT * FROM users ORDER BY created_at DESC");
    $users = $stmt->fetchAll(PDO::FETCH_ASSOC);
    ?>
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div><h2 class="admin-header-title">Registered Customers</h2><p class="text-muted m-0">Manage your community.</p></div>
        <div class="bg-white px-4 py-2 rounded-pill shadow-sm border d-flex align-items-center gap-2"><i class="bi bi-people-fill text-success"></i><span class="fw-bold"><?= count($users) ?></span> <span class="text-muted small text-uppercase">Members</span></div>
    </div>
    <div class="row g-4">
        <?php foreach ($users as $u): ?>
            <div class="col-md-6 col-lg-4 col-xl-3">
                <div class="customer-card-grid">
                    <span class="cust-id-badge">ID: <?= str_pad($u['id'], 3, '0', STR_PAD_LEFT) ?></span>
                    <a href="delete_user.php?id=<?= $u['id'] ?>" class="btn-delete-user" onclick="return confirm('Delete this user?');" title="Delete User"><i class="bi bi-trash-fill"></i></a>
                    <div class="cust-avatar-lg"><?= strtoupper(substr($u['full_name'], 0, 1)) ?></div>
                    <h5 class="cust-name text-truncate"><?= htmlspecialchars($u['full_name']) ?></h5>
                    <p class="cust-email text-truncate"><?= htmlspecialchars($u['email']) ?></p>
                    <div class="cust-divider"></div>
                    <span class="cust-joined"><i class="bi bi-calendar2 me-1"></i> Joined <?= date('M d, Y', strtotime($u['created_at'])) ?></span>
                    <a href="#" onclick="loadView('customer_details&id=<?= $u['id'] ?>')" class="btn-view-orders">View Orders</a>
                </div>
            </div>
        <?php endforeach; ?>
    </div>
    <?php
}

// --- VIEW 4: REVIEWS ---
elseif ($view == 'reviews') {
    $stmt = $pdo->query("SELECT r.*, u.full_name, p.name as product_name, p.image as product_image 
                         FROM reviews r 
                         JOIN users u ON r.user_id = u.id 
                         JOIN products p ON r.product_id = p.id 
                         ORDER BY r.created_at DESC");
    $reviews = $stmt->fetchAll(PDO::FETCH_ASSOC);

    // Calculate Stats
    $totalReviews = count($reviews);
    $avgRating = 0;
    if ($totalReviews > 0) {
        $sum = array_sum(array_column($reviews, 'rating'));
        $avgRating = number_format($sum / $totalReviews, 1);
    }
    ?>
    
    <div class="d-flex justify-content-between align-items-end mb-5">
        <div>
            <h2 class="admin-header-title">Review Gallery</h2>
            <p class="text-muted m-0">Insights directly from your customers.</p>
        </div>
    </div>

    <div class="review-stats-bar">
        <div class="r-stat-box">
            <div class="r-icon"><i class="bi bi-chat-quote-fill"></i></div>
            <div class="r-info">
                <h3><?= $totalReviews ?></h3>
                <span>Total Reviews</span>
            </div>
        </div>
        <div class="r-stat-box">
            <div class="r-icon" style="background: #e0f2fe; color: #0369a1;"><i class="bi bi-star-half"></i></div>
            <div class="r-info">
                <h3><?= $avgRating ?></h3>
                <span>Average Rating</span>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <?php if ($totalReviews > 0): ?>
            <?php foreach ($reviews as $r): ?>
                <div class="col-xl-4 col-md-6">
                    <div class="review-card-modern">
                        <div class="rc-quote-icon">‚Äù</div>
                        
                        <div class="rc-header">
                            <div class="rc-user">
                                <div class="rc-avatar"><?= strtoupper(substr($r['full_name'], 0, 1)) ?></div>
                                <div class="rc-meta">
                                    <h6><?= htmlspecialchars($r['full_name']) ?></h6>
                                    <span><?= date('M d, Y', strtotime($r['created_at'])) ?></span>
                                </div>
                            </div>
                            <div class="rc-product-badge">
                                <img src="assets/images/<?= $r['product_image'] ?: 'default.jpg' ?>">
                                <span class="text-truncate"><?= htmlspecialchars($r['product_name']) ?></span>
                            </div>
                        </div>

                        <div class="rc-rating">
                            <?php for($i=0; $i<$r['rating']; $i++) echo '<i class="bi bi-star-fill"></i>'; ?>
                            <?php for($i=$r['rating']; $i<5; $i++) echo '<i class="bi bi-star text-muted opacity-25"></i>'; ?>
                        </div>

                        <p class="rc-comment">
                            <?= htmlspecialchars($r['comment']) ?>
                        </p>

                        <div class="rc-actions">
                            <a href="delete_review.php?id=<?= $r['id'] ?>" class="btn-delete-review text-decoration-none" onclick="return confirm('Delete this review?');">
                                <i class="bi bi-trash me-1"></i> Remove
                            </a>
                        </div>
                    </div>
                </div>
            <?php endforeach; ?>
        <?php else: ?>
            <div class="col-12">
                <div class="text-center py-5 bg-white rounded-4 border border-light">
                    <div class="mb-3">
                        <span style="font-size: 4rem;">üí¨</span>
                    </div>
                    <h4 class="text-muted font-serif">Quiet around here...</h4>
                    <p class="text-muted">No customer reviews have been posted yet.</p>
                </div>
            </div>
        <?php endif; ?>
    </div>
    <?php
}

// --- VIEW 5: CUSTOMER DETAILS ---
elseif ($view == 'customer_details') {
    $userId = $_GET['id'];
    $stmtUser = $pdo->prepare("SELECT * FROM users WHERE id = ?");
    $stmtUser->execute([$userId]);
    $user = $stmtUser->fetch(PDO::FETCH_ASSOC);

    $stmtOrders = $pdo->prepare("SELECT * FROM orders WHERE user_id = ? ORDER BY created_at DESC");
    $stmtOrders->execute([$userId]);
    $userOrders = $stmtOrders->fetchAll(PDO::FETCH_ASSOC);
    
    $lifetimeSpend = array_sum(array_column($userOrders, 'total_amount'));
    $totalOrders = count($userOrders);
    $avgOrder = $totalOrders > 0 ? $lifetimeSpend / $totalOrders : 0;
    ?>
    <div class="mb-4">
        <a href="#" onclick="loadView('users')" class="text-decoration-none text-muted small fw-bold text-uppercase"><i class="bi bi-arrow-left me-1"></i> Back to Customers</a>
    </div>
    <div class="admin-customer-header">
        <div class="d-flex align-items-center gap-4">
            <div class="customer-avatar-large"><?= strtoupper(substr($user['full_name'], 0, 1)) ?></div>
            <div>
                <h2 class="font-serif m-0"><?= htmlspecialchars($user['full_name']) ?></h2>
                <p class="text-muted m-0"><?= htmlspecialchars($user['email']) ?></p>
            </div>
        </div>
        <div class="customer-stats-row">
            <div><span class="c-stat-label">Total Spend</span><div class="c-stat-value text-success">$<?= number_format($lifetimeSpend, 2) ?></div></div>
            <div><span class="c-stat-label">Total Orders</span><div class="c-stat-value"><?= $totalOrders ?></div></div>
            <div><span class="c-stat-label">Avg. Order</span><div class="c-stat-value text-muted">$<?= number_format($avgOrder, 2) ?></div></div>
        </div>
    </div>
    <h4 class="font-serif mb-4">Order History</h4>
    <div class="timeline-wrapper">
        <?php foreach ($userOrders as $order): ?>
            <div class="timeline-item">
                <div class="timeline-dot"></div>
                <div class="timeline-card">
                    <div class="timeline-header">
                        <div><span class="badge bg-light text-dark border me-2">#<?= $order['id'] ?></span><span class="t-date"><?= date('F d, Y', strtotime($order['created_at'])) ?></span></div>
                        <div class="t-total">$<?= number_format($order['total_amount'], 2) ?></div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge bg-secondary"><?= $order['status'] ?></span>
                        <a href="order_details.php?order_id=<?= $order['id'] ?>" class="btn btn-sm btn-outline-dark rounded-pill px-3">View Items</a>
                    </div>
                </div>
            </div>
        <?php endforeach; ?>
    </div>
    <?php
}

// --- VIEW 6: ORDERS MANAGEMENT ---
elseif ($view == 'orders') {
    $statusFilter = $_GET['status'] ?? 'All';
    
    $sql = "SELECT * FROM orders";
    $params = [];
    if ($statusFilter != 'All') {
        $sql .= " WHERE status = ?";
        $params[] = $statusFilter;
    }
    $sql .= " ORDER BY created_at DESC";
    
    $stmt = $pdo->prepare($sql);
    $stmt->execute($params);
    $allOrders = $stmt->fetchAll(PDO::FETCH_ASSOC);
    ?>

    <div class="d-flex justify-content-between align-items-end mb-5">
        <div>
            <h2 class="admin-header-title">Order Management</h2>
            <p class="text-muted m-0">Track, fulfill, and manage customer orders.</p>
        </div>
        <div class="filter-glass-container">
            <?php 
            $statuses = ['All', 'Pending', 'Shipped', 'Delivered', 'Cancelled'];
            foreach($statuses as $s): 
                $activeClass = ($statusFilter == $s) ? 'active' : '';
                $param = ($s == 'All') ? 'orders' : "orders&status=$s";
            ?>
                <button onclick="loadView('<?= $param ?>')" class="filter-tab-btn <?= $activeClass ?>"><?= $s ?></button>
            <?php endforeach; ?>
        </div>
    </div>

    <div class="dashboard-card p-0 overflow-hidden">
        <div class="table-responsive">
            <table class="table mb-0 align-middle">
                <thead class="bg-light border-bottom">
                    <tr>
                        <th class="ps-4 py-3 text-muted small text-uppercase">Order ID</th>
                        <th class="py-3 text-muted small text-uppercase">Customer</th>
                        <th class="py-3 text-muted small text-uppercase">Date Placed</th>
                        <th class="py-3 text-muted small text-uppercase">Total</th>
                        <th class="py-3 text-muted small text-uppercase">Status</th>
                        <th class="pe-4 py-3 text-end text-muted small text-uppercase">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <?php if (count($allOrders) > 0): ?>
                        <?php foreach ($allOrders as $order): ?>
                        <tr class="order-row-strip">
                            <td class="ps-4"><span class="order-id-badge">#<?= str_pad($order['id'], 5, '0', STR_PAD_LEFT) ?></span></td>
                            <td>
                                <div class="order-customer-box">
                                    <span class="order-customer-name"><?= htmlspecialchars($order['customer_name']) ?></span>
                                    <div class="order-customer-meta"><i class="bi bi-geo-alt-fill" style="font-size: 0.7rem;"></i> <span class="text-truncate" style="max-width: 150px;"><?= htmlspecialchars($order['address']) ?></span></div>
                                </div>
                            </td>
                            <td><div class="text-dark fw-bold small"><?= date('M d, Y', strtotime($order['created_at'])) ?></div><small class="text-muted"><?= date('h:i A', strtotime($order['created_at'])) ?></small></td>
                            <td><span class="order-total-display">$<?= number_format($order['total_amount'], 2) ?></span></td>
                            <td>
                                <?php 
                                    $s = $order['status'];
                                    $classMap = ['Pending' => 'st-pending', 'Shipped' => 'st-shipped', 'Delivered' => 'st-delivered', 'Cancelled' => 'st-cancelled'];
                                    $stClass = $classMap[$s] ?? 'st-pending';
                                ?>
                                <div class="status-indicator <?= $stClass ?>"><span class="status-dot"></span> <?= $s ?></div>
                            </td>
                            <td class="pe-4 text-end"><a href="order_details.php?order_id=<?= $order['id'] ?>" class="btn-manage-pill text-decoration-none">Manage <i class="bi bi-arrow-right ms-1"></i></a></td>
                        </tr>
                        <?php endforeach; ?>
                    <?php else: ?>
                        <tr><td colspan="6" class="text-center py-5"><div class="py-5"><i class="bi bi-inbox display-3 text-muted opacity-25 mb-3 d-block"></i><h5 class="text-muted">No <?= $statusFilter == 'All' ? '' : $statusFilter ?> orders found.</h5></div></td></tr>
                    <?php endif; ?>
                </tbody>
            </table>
        </div>
    </div>
    <?php
}
?>


================================================
FILE: cart.php
================================================
<?php
include 'db.php';
session_start();

// 1. Handle Coupon Logic
$coupon_msg = '';
$coupon_error = '';

if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['apply_coupon'])) {
    $code = trim($_POST['coupon_code']);
    
    // Check DB for valid coupon
    $stmt = $pdo->prepare("SELECT * FROM coupons WHERE code = ? AND status = 'Active' AND expiry_date >= CURDATE()");
    $stmt->execute([$code]);
    $coupon = $stmt->fetch(PDO::FETCH_ASSOC);

    if ($coupon) {
        $_SESSION['discount'] = [
            'code' => $coupon['code'],
            'percent' => $coupon['discount_percent']
        ];
        $coupon_msg = "Coupon '{$coupon['code']}' applied!";
    } else {
        $coupon_error = "Invalid or expired coupon.";
        unset($_SESSION['discount']);
    }
}

// Remove Coupon
if (isset($_GET['remove_coupon'])) {
    unset($_SESSION['discount']);
    header("Location: cart.php");
    exit;
}

// 2. Fetch Cart Items
$cartItems = [];
$subTotal = 0;

if (!empty($_SESSION['cart'])) {
    $ids = implode(',', array_keys($_SESSION['cart']));
    // Fetch products
    $stmt = $pdo->query("SELECT * FROM products WHERE id IN ($ids)");
    $products = $stmt->fetchAll(PDO::FETCH_ASSOC);

    foreach ($products as $product) {
        $qty = $_SESSION['cart'][$product['id']];
        $lineTotal = $product['price'] * $qty;
        
        $cartItems[] = [
            'id' => $product['id'],
            'name' => $product['name'], 
            'price' => $product['price'],
            'image' => $product['image'], // Added image to array
            'category' => $product['category'], // Added category
            'qty' => $qty,
            'subtotal' => $lineTotal
        ];
        $subTotal += $lineTotal;
    }
}

// 3. Calculate Totals
$discountAmount = 0;
$finalTotal = $subTotal;

if (isset($_SESSION['discount'])) {
    $discountAmount = ($subTotal * $_SESSION['discount']['percent']) / 100;
    $finalTotal = $subTotal - $discountAmount;
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Shopping Cart | FreshCart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css?v=<?php echo time(); ?>">
</head>
<body class="container mt-5 mb-5">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="m-0">Your Shopping Bag</h2>
            <p class="text-muted m-0"><?= array_sum($_SESSION['cart'] ?? []) ?> items in your cart</p>
        </div>
        <a href="index.php" class="btn btn-outline-secondary rounded-pill">
            <i class="bi bi-arrow-left me-2"></i> Continue Shopping
        </a>
    </div>

    <?php if (empty($cartItems)): ?>
        
        <div class="empty-cart-state animate-fade-in">
            <i class="bi bi-basket3 empty-icon"></i>
            <h3 class="mb-3" style="font-family: var(--font-serif);">Your bag is empty</h3>
            <p class="text-muted mb-4">Looks like you haven't added any fresh goodies yet.</p>
            <a href="index.php" class="btn btn-primary btn-lg rounded-pill px-5">Start Shopping</a>
        </div>

    <?php else: ?>

        <div class="row g-5 animate-fade-in">
            
            <div class="col-lg-8">
                <?php foreach ($cartItems as $item): ?>
                    <div class="cart-item-card">
                        
                        <div class="cart-img-wrapper">
                            <?php $img = $item['image'] ? $item['image'] : 'default.jpg'; ?>
                            <img src="assets/images/<?= $img ?>" alt="<?= htmlspecialchars($item['name']) ?>">
                        </div>

                        <div class="cart-item-details">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <span class="badge bg-light text-dark border mb-1"><?= htmlspecialchars($item['category']) ?></span>
                                    <a href="product.php?id=<?= $item['id'] ?>" class="cart-item-title d-block"><?= htmlspecialchars($item['name']) ?></a>
                                    <div class="cart-item-meta mt-1">
                                        $<?= number_format($item['price'], 2) ?> / unit
                                    </div>
                                </div>
                                
                                <form action="remove_from_cart.php" method="POST">
                                    <input type="hidden" name="product_id" value="<?= $item['id'] ?>">
                                    <button type="submit" class="btn-remove border-0" title="Remove Item">
                                        <i class="bi bi-x-lg"></i>
                                    </button>
                                </form>
                            </div>

                            <div class="d-flex align-items-center border rounded-pill px-2" style="width: fit-content;">
                                <form action="update_cart.php" method="POST" class="d-flex align-items-center">
                                    <input type="hidden" name="product_id" value="<?= $item['id'] ?>">
                                    <input type="hidden" name="action" value="decrease">
                                    <button type="submit" class="btn btn-sm text-muted p-0 border-0"><i class="bi bi-dash"></i></button>
                                </form>
                                
                                <span class="mx-3 fw-bold small"><?= $item['qty'] ?></span>
                                
                                <form action="update_cart.php" method="POST" class="d-flex align-items-center">
                                    <input type="hidden" name="product_id" value="<?= $item['id'] ?>">
                                    <input type="hidden" name="action" value="increase">
                                    <button type="submit" class="btn btn-sm text-muted p-0 border-0"><i class="bi bi-plus"></i></button>
                                </form>
                            </div>
                        </div>
                    </div>
                <?php endforeach; ?>
            </div>

            <div class="col-lg-4">
                <div class="cart-summary-card shadow-sm">
                    <h5 class="mb-4" style="font-family: var(--font-serif);">Order Summary</h5>

                    <form method="POST" class="mb-4" id="couponForm">
                        <label class="small text-muted mb-2 text-uppercase fw-bold">Discount Code</label>
                        <div class="coupon-input-group">
                            <input type="text" name="coupon_code" id="couponField" class="coupon-input" placeholder="Enter code">
                            <button type="submit" name="apply_coupon" class="coupon-btn">Apply</button>
                        </div>
                        
                        <div class="mt-3">
                            <small class="text-muted fw-bold" style="font-size: 0.7rem;">AVAILABLE OFFERS:</small>
                            
                            <div class="d-flex align-items-center justify-content-between p-2 mt-2 border border-dashed rounded bg-light" style="border-style: dashed !important; border-color: #ccc;">
                                <div class="d-flex align-items-center gap-2">
                                    <i class="bi bi-tag-fill text-success"></i>
                                    <div>
                                        <span class="d-block fw-bold text-dark small">WELCOME20</span>
                                        <span class="d-block text-muted" style="font-size: 0.65rem;">20% off your first order</span>
                                    </div>
                                </div>
                                <button type="button" onclick="applyCode('WELCOME20')" class="btn btn-sm btn-link text-decoration-none p-0 text-success fw-bold" style="font-size: 0.75rem;">APPLY</button>
                            </div>

                            <div class="d-flex align-items-center justify-content-between p-2 mt-2 border border-dashed rounded bg-light" style="border-style: dashed !important; border-color: #ccc;">
                                <div class="d-flex align-items-center gap-2">
                                    <i class="bi bi-lightning-fill text-warning"></i>
                                    <div>
                                        <span class="d-block fw-bold text-dark small">FRESH50</span>
                                        <span class="d-block text-muted" style="font-size: 0.65rem;">50% off huge savings</span>
                                    </div>
                                </div>
                                <button type="button" onclick="applyCode('FRESH50')" class="btn btn-sm btn-link text-decoration-none p-0 text-success fw-bold" style="font-size: 0.75rem;">APPLY</button>
                            </div>
                        </div>

                        <?php if ($coupon_msg): ?>
                            <div class="text-success small mt-3"><i class="bi bi-check-circle-fill"></i> <?= $coupon_msg ?></div>
                        <?php endif; ?>
                        <?php if ($coupon_error): ?>
                            <div class="text-danger small mt-3"><i class="bi bi-exclamation-circle-fill"></i> <?= $coupon_error ?></div>
                        <?php endif; ?>
                    </form>

                    <script>
                        function applyCode(code) {
                            document.getElementById('couponField').value = code;
                        }
                    </script>
                        
                        <?php if ($coupon_msg): ?>
                            <div class="text-success small"><i class="bi bi-check-circle-fill"></i> <?= $coupon_msg ?></div>
                        <?php endif; ?>
                        <?php if ($coupon_error): ?>
                            <div class="text-danger small"><i class="bi bi-exclamation-circle-fill"></i> <?= $coupon_error ?></div>
                        <?php endif; ?>
                    </form>

                    <div class="summary-row">
                        <span>Subtotal</span>
                        <span class="fw-bold">$<?= number_format($subTotal, 2) ?></span>
                    </div>

                    <?php if (isset($_SESSION['discount'])): ?>
                        <div class="summary-row text-success">
                            <span>Discount (<?= $_SESSION['discount']['percent'] ?>%)</span>
                            <span>-$<?= number_format($discountAmount, 2) ?></span>
                        </div>
                        <div class="text-end mb-2">
                            <a href="cart.php?remove_coupon=true" class="text-danger small text-decoration-none" style="font-size: 0.8rem;">[Remove Coupon]</a>
                        </div>
                    <?php endif; ?>

                    <div class="summary-row text-muted">
                        <span>Shipping</span>
                        <span>Free</span>
                    </div>

                    <div class="summary-total">
                        <span class="fs-5 fw-bold">Total</span>
                        <span class="summary-total-price">$<?= number_format($finalTotal, 2) ?></span>
                    </div>

                    <a href="checkout.php" class="btn btn-primary w-100 py-3 mt-4 shadow rounded-pill text-uppercase" style="letter-spacing: 0.1em;">
                        Proceed to Checkout
                    </a>
                    
                    <div class="text-center mt-3">
                        <small class="text-muted"><i class="bi bi-shield-lock-fill me-1"></i> Secure Checkout</small>
                    </div>
                </div>
            </div>

        </div>

    <?php endif; ?>

</body>
</html>


================================================
FILE: checkout.php
================================================
<?php
session_start();
include 'db.php';

// If cart is empty, kick them back to the shop
if (empty($_SESSION['cart'])) {
    header("Location: index.php");
    exit;
}

// 1. AUTO-FILL LOGIC
$pre_name = "";
$pre_address = "";

if (isset($_SESSION['user_id'])) {
    $stmtUser = $pdo->prepare("SELECT full_name, address FROM users WHERE id = ?");
    $stmtUser->execute([$_SESSION['user_id']]);
    $user = $stmtUser->fetch(PDO::FETCH_ASSOC);
    if ($user) {
        $pre_name = $user['full_name'];
        $pre_address = $user['address'];
    }
}

// 2. FETCH CART ITEMS & CALCULATE TOTAL
// (We need this to display the summary list on the right)
$cartItems = [];
$ids = implode(',', array_keys($_SESSION['cart']));
$stmt = $pdo->query("SELECT * FROM products WHERE id IN ($ids)");
$products = $stmt->fetchAll(PDO::FETCH_ASSOC);

$subTotal = 0;
foreach ($products as $p) {
    $qty = $_SESSION['cart'][$p['id']];
    $lineTotal = $p['price'] * $qty;
    $cartItems[] = [
        'name' => $p['name'],
        'image' => $p['image'],
        'price' => $p['price'],
        'qty' => $qty,
        'line_total' => $lineTotal
    ];
    $subTotal += $lineTotal;
}

// Apply Discount if exists
$finalTotal = $subTotal;
$discountAmount = 0;
if (isset($_SESSION['discount'])) {
    $discountAmount = ($subTotal * $_SESSION['discount']['percent']) / 100;
    $finalTotal = $subTotal - $discountAmount;
}

include 'includes/header.php';
?>

<div class="checkout-page-wrapper pt-5">
    <div class="container">
        
        <div class="mb-4">
            <a href="cart.php" class="text-decoration-none text-muted small text-uppercase fw-bold"><i class="bi bi-arrow-left me-1"></i> Back to Cart</a>
            <h2 class="mt-2" style="font-family: var(--font-serif);">Secure Checkout</h2>
        </div>

        <form action="place_order.php" method="POST">
            <div class="row g-5">
                
                <div class="col-lg-7">
                    
                    <div class="checkout-form-card mb-4">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <h4 class="step-title">Shipping Details</h4>
                        </div>
                        
                        <div class="mb-4">
                            <label class="auth-label">Full Name</label>
                            <input type="text" name="customer_name" class="form-control form-control-pill" 
                                   value="<?= htmlspecialchars($pre_name) ?>" placeholder="John Doe" required>
                        </div>

                        <div class="mb-4">
                            <label class="auth-label">Delivery Address</label>
                            <textarea name="address" class="form-control form-control-pill" rows="3" required 
                                      placeholder="123 Fresh Street, Green City..."><?= htmlspecialchars($pre_address) ?></textarea>
                        </div>
                    </div>

                    <div class="checkout-form-card">
                        <div class="step-header">
                            <div class="step-number">2</div>
                            <h4 class="step-title">Payment Method</h4>
                        </div>

                        <label class="payment-option-card active">
                            <input type="radio" name="payment_method" value="COD" checked class="payment-radio">
                            <div class="d-flex align-items-center gap-3">
                                <i class="bi bi-cash-stack fs-3 text-success"></i>
                                <div>
                                    <span class="d-block fw-bold">Cash on Delivery (COD)</span>
                                    <small class="text-muted">Pay when your order arrives.</small>
                                </div>
                            </div>
                        </label>
                        
                        <label class="payment-option-card mt-3 opacity-50" style="cursor: not-allowed;">
                            <input type="radio" disabled class="payment-radio">
                            <div class="d-flex align-items-center gap-3">
                                <i class="bi bi-credit-card fs-3"></i>
                                <div>
                                    <span class="d-block fw-bold">Credit Card / Online</span>
                                    <small class="text-muted">Coming soon to FreshCart.</small>
                                </div>
                            </div>
                        </label>

                    </div>

                </div>

                <div class="col-lg-5">
                    <div class="order-summary-card">
                        <h5 class="mb-4 font-serif">Order Summary</h5>
                        
                        <div class="mb-4" style="max-height: 300px; overflow-y: auto; padding-right: 5px;">
                            <?php foreach ($cartItems as $item): ?>
                                <div class="checkout-item-row">
                                    <img src="assets/images/<?= $item['image'] ?: 'default.jpg' ?>" class="checkout-item-img">
                                    <div class="flex-grow-1">
                                        <h6 class="m-0 small fw-bold"><?= htmlspecialchars($item['name']) ?></h6>
                                        <small class="text-muted">Qty: <?= $item['qty'] ?></small>
                                    </div>
                                    <div class="fw-bold small">$<?= number_format($item['line_total'], 2) ?></div>
                                </div>
                            <?php endforeach; ?>
                        </div>

                        <div class="d-flex justify-content-between mb-2 small text-muted">
                            <span>Subtotal</span>
                            <span>$<?= number_format($subTotal, 2) ?></span>
                        </div>
                        
                        <?php if ($discountAmount > 0): ?>
                            <div class="d-flex justify-content-between mb-2 small text-success">
                                <span>Discount</span>
                                <span>-$<?= number_format($discountAmount, 2) ?></span>
                            </div>
                        <?php endif; ?>

                        <div class="d-flex justify-content-between mb-2 small text-muted">
                            <span>Shipping</span>
                            <span>Free</span>
                        </div>

                        <div class="checkout-total-row">
                            <span>Total to Pay</span>
                            <span>$<?= number_format($finalTotal, 2) ?></span>
                        </div>

                        <button type="submit" class="btn-confirm-order">
                            Confirm Order
                        </button>

                        <div class="text-center mt-3 small text-muted">
                            <i class="bi bi-lock-fill"></i> SSL Secure Payment
                        </div>
                    </div>
                </div>

            </div>
        </form>
    </div>
</div>

<?php include 'includes/footer.php'; ?>


================================================
FILE: contact.php
================================================
<?php 
include 'db.php'; 
session_start();
include 'includes/header.php'; 
?>

<div class="contact-section-wrapper">
    <div class="container">
        
        <div class="contact-card-modern">
            
            <div class="col-lg-5 contact-info-panel">
                <h1 class="contact-heading-serif">Get in touch</h1>
                <p class="opacity-75 mb-5">
                    Have a question about your order, organic sourcing, or want to partner with us? We'd love to hear from you.
                </p>

                <ul class="contact-details-list">
                    <li>
                        <div class="contact-icon-circle"><i class="bi bi-geo-alt-fill"></i></div>
                        <div>
                            <span class="d-block fw-bold mb-1">Visit Us</span>
                            <span class="opacity-75 small">123 Market Street<br>San Francisco, CA 94103</span>
                        </div>
                    </li>
                    <li>
                        <div class="contact-icon-circle"><i class="bi bi-envelope-fill"></i></div>
                        <div>
                            <span class="d-block fw-bold mb-1">Email Us</span>
                            <span class="opacity-75 small">hello@freshcart.com</span>
                        </div>
                    </li>
                    <li>
                        <div class="contact-icon-circle"><i class="bi bi-telephone-fill"></i></div>
                        <div>
                            <span class="d-block fw-bold mb-1">Call Us</span>
                            <span class="opacity-75 small">+1 (555) 123-4567</span>
                        </div>
                    </li>
                </ul>

                <div class="mt-auto">
                    <p class="small text-uppercase fw-bold opacity-75 mb-3">Follow our journey</p>
                    <div class="contact-socials">
                        <a href="https://www.facebook.com/notagirlgamer69" target="_blank" class="social-btn-glass"><i class="bi bi-facebook"></i></a>
                        <a href="https://www.instagram.com/janusinss/" target="_blank" class="social-btn-glass"><i class="bi bi-instagram"></i></a>
                        <a href="https://x.com/Syrupynut" target="_blank" class="social-btn-glass"><i class="bi bi-twitter"></i></a>
                        <a href="https://www.linkedin.com/in/janusdominic/" target="_blank" class="social-btn-glass"><i class="bi bi-linkedin"></i></a>
                    </div>
                </div>
            </div>

            <div class="col-lg-7 contact-form-panel">
                <form action="#" method="POST"> <div class="row g-4">
                        <div class="col-md-6">
                            <label class="form-label-custom">First Name</label>
                            <input type="text" class="form-control form-control-pill" placeholder="e.g. Janus">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label-custom">Last Name</label>
                            <input type="text" class="form-control form-control-pill" placeholder="e.g. Dominic">
                        </div>
                        <div class="col-12">
                            <label class="form-label-custom">Email Address</label>
                            <input type="email" class="form-control form-control-pill" placeholder="name@example.com">
                        </div>
                        <div class="col-12">
                            <label class="form-label-custom">Subject (Optional)</label>
                            <select class="form-select form-control-pill">
                                <option>Order Inquiry</option>
                                <option>Product Question</option>
                                <option>Partnership</option>
                                <option>Other</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="form-label-custom">Message</label>
                            <textarea class="form-control form-control-pill" rows="5" placeholder="How can we help you?"></textarea>
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn-send-message">
                                Send Message <i class="bi bi-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>

<?php include 'includes/footer.php'; ?>


================================================
FILE: db.php
================================================
<?php
$host = 'localhost';
$dbname = 'grocery_db';
$username = 'root';  // Default for XAMPP
$password = '';      // Default is empty for XAMPP

try {
    // We use PDO because it is more secure and professional than old MySQLi
    $pdo = new PDO("mysql:host=$host;dbname=$dbname", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    die("Connection failed: " . $e->getMessage());
}
?>


================================================
FILE: debug_log.txt
================================================
Request at 2025-11-27 06:44:59
Session ID: vhl83n6qaae2kppa65rqi1ke41
User ID: 1
POST Data: Array
(
    [product_id] => 1
)

Success: Item added. Cart count: 1
-------------------



================================================
FILE: delete_product.php
================================================
<?php
include 'db.php';
session_start();

// Security Check
if (!isset($_SESSION['admin_logged_in']) || $_SESSION['admin_logged_in'] !== true) {
    header("Location: login.php");
    exit;
}

if (isset($_GET['id'])) {
    $id = $_GET['id'];
    
    // Delete from database
    $stmt = $pdo->prepare("DELETE FROM products WHERE id = ?");
    $stmt->execute([$id]);
}

// Redirect back
header("Location: admin_products.php");
exit;
?>


================================================
FILE: delete_review.php
================================================
<?php
include 'db.php';
session_start();

// Security Check
if (!isset($_SESSION['admin_logged_in']) || $_SESSION['admin_logged_in'] !== true) {
    header("Location: login.php");
    exit;
}

if (isset($_GET['id'])) {
    $id = $_GET['id'];
    
    // Delete from database
    $stmt = $pdo->prepare("DELETE FROM reviews WHERE id = ?");
    $stmt->execute([$id]);
}

// Redirect back
header("Location: admin_reviews.php");
exit;
?>


================================================
FILE: delete_user.php
================================================
<?php
include 'db.php';
session_start();

// Security Check
if (!isset($_SESSION['admin_logged_in']) || $_SESSION['admin_logged_in'] !== true) {
    header("Location: login.php");
    exit;
}

if (isset($_GET['id'])) {
    $id = $_GET['id'];
    
    // Delete User (Database constraints will auto-delete their orders/reviews)
    $stmt = $pdo->prepare("DELETE FROM users WHERE id = ?");
    $stmt->execute([$id]);
}

// Redirect back
header("Location: admin_users.php");
exit;
?>


================================================
FILE: edit_product.php
================================================
<?php
include 'db.php';
session_start();

// Security Check
if (!isset($_SESSION['admin_logged_in']) || $_SESSION['admin_logged_in'] !== true) {
    header("Location: login.php");
    exit;
}

$id = $_GET['id'] ?? null;
// FIX: Redirect to the main admin router if no ID
if (!$id) { header("Location: admin.php?view=products"); exit; }

// Handle Update
if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    $newStock = $_POST['stock_qty'];
    $newPrice = $_POST['price'];
    $newCat   = $_POST['category'];

    // 1. Check if a NEW image was uploaded
    if (isset($_FILES['image']) && $_FILES['image']['error'] == 0) {
        $target_dir = "assets/images/";
        $file_extension = pathinfo($_FILES["image"]["name"], PATHINFO_EXTENSION);
        $new_filename = uniqid() . "." . $file_extension;
        $target_file = $target_dir . $new_filename;
        $allowed_types = ['jpg', 'jpeg', 'png', 'gif'];
        
        if (in_array(strtolower($file_extension), $allowed_types)) {
            if (move_uploaded_file($_FILES["image"]["tmp_name"], $target_file)) {
                $sql = "UPDATE products SET stock_qty = ?, price = ?, category = ?, image = ? WHERE id = ?";
                $stmt = $pdo->prepare($sql);
                $stmt->execute([$newStock, $newPrice, $newCat, $new_filename, $id]);
                
                // FIX: Redirect to admin.php with success message
                header("Location: admin.php?view=products&msg=updated");
                exit;
            }
        }
    }

    // 2. If NO image uploaded
    $sql = "UPDATE products SET stock_qty = ?, price = ?, category = ? WHERE id = ?";
    $stmt = $pdo->prepare($sql);
    $stmt->execute([$newStock, $newPrice, $newCat, $id]);

    // FIX: Redirect to admin.php with success message
    header("Location: admin.php?view=products&msg=updated");
    exit;
}

$stmt = $pdo->prepare("SELECT * FROM products WHERE id = ?");
$stmt->execute([$id]);
$product = $stmt->fetch(PDO::FETCH_ASSOC);
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Edit Product | Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css?v=<?php echo time(); ?>">
</head>
<body style="background-color: var(--bg-color);">

    <div class="edit-product-wrapper">
        <div class="edit-card animate-fade-in">
            
            <h2 class="edit-title">Edit Product</h2>

            <form method="POST" enctype="multipart/form-data">
                
                <div class="edit-img-preview-box mb-0">
                    <img src="assets/images/<?= $product['image'] ?>" id="currentPreviewImage" alt="Current Image">
                    <div class="edit-img-overlay" id="previewOverlay">Current</div>
                </div>
                <p id="changeImageHelper" class="text-center text-muted small fw-bold text-uppercase mt-2 mb-4" style="display: none; letter-spacing: 0.05em;">
                    Click "Update Image" below to change selection
                </p>

                <div class="mb-4 mt-4">
                    <label class="form-label-edit">Product Name (Read-only)</label>
                    <input type="text" class="form-control form-control-edit text-muted" value="<?= htmlspecialchars($product['name']) ?>" readonly style="background: #f0f0f0;">
                </div>

                <div class="mb-4">
                    <label class="form-label-edit">Update Image</label>
                    <input type="file" name="image" id="editImageInput" class="form-control form-control-edit" accept="image/*">
                </div>

                <div class="row">
                    <div class="col-md-6 mb-4">
                        <label class="form-label-edit">Category</label>
                        <select name="category" class="form-select form-control-edit">
                            <option value="Fruits" <?= $product['category'] == 'Fruits' ? 'selected' : '' ?>>Fruits</option>
                            <option value="Dairy" <?= $product['category'] == 'Dairy' ? 'selected' : '' ?>>Dairy</option>
                            <option value="Bakery" <?= $product['category'] == 'Bakery' ? 'selected' : '' ?>>Bakery</option>
                            <option value="Beverages" <?= $product['category'] == 'Beverages' ? 'selected' : '' ?>>Beverages</option>
                            <option value="General" <?= $product['category'] == 'General' ? 'selected' : '' ?>>General</option>
                            <option value="Pantry" <?= $product['category'] == 'Pantry' ? 'selected' : '' ?>>Pantry</option>
                            <option value="Meat" <?= $product['category'] == 'Meat' ? 'selected' : '' ?>>Meat</option>
                            <option value="Snacks" <?= $product['category'] == 'Snacks' ? 'selected' : '' ?>>Snacks</option>
                            <option value="Vegetables" <?= $product['category'] == 'Vegetables' ? 'selected' : '' ?>>Vegetables</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-4">
                        <label class="form-label-edit">Price ($)</label>
                        <input type="number" step="0.01" name="price" class="form-control form-control-edit" value="<?= $product['price'] ?>" required>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="form-label-edit">Stock Quantity</label>
                    <input type="number" name="stock_qty" class="form-control form-control-edit" value="<?= $product['stock_qty'] ?>" required>
                </div>

                <button type="submit" class="btn-save">Save Changes</button>
                
                <a href="admin.php?view=products" class="btn-cancel-link">Cancel</a>

            </form>
        </div>
    </div>

    <script>
        // Image Preview Logic for Edit Product
        const editInput = document.getElementById('editImageInput');
        const previewImg = document.getElementById('currentPreviewImage');
        const helperText = document.getElementById('changeImageHelper');
        const overlayText = document.getElementById('previewOverlay');

        editInput.addEventListener('change', function() {
            const file = this.files[0];
            
            if (file) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    // Update the src of the top image instantly
                    previewImg.src = e.target.result;
                    // Show the helper text
                    helperText.style.display = 'block';
                    // Change overlay label
                    overlayText.innerText = 'New Selection';
                }
                
                reader.readAsDataURL(file);
            }
        });
    </script>

</body>
</html>


================================================
FILE: export_orders.php
================================================
<?php
include 'db.php';
session_start();

if (!isset($_SESSION['admin_logged_in'])) { exit; }

// Set Headers to force download
header('Content-Type: text/csv; charset=utf-8');
header('Content-Disposition: attachment; filename=orders_export.csv');

// Create File Pointer
$output = fopen('php://output', 'w');

// Add Column Headings
fputcsv($output, ['Order ID', 'Customer', 'Address', 'Total', 'Status', 'Date']);

// Fetch Data
$stmt = $pdo->query("SELECT id, customer_name, address, total_amount, status, created_at FROM orders");
while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
    fputcsv($output, $row);
}

fclose($output);
exit;
?>


================================================
FILE: farmers.php
================================================
<?php 
include 'db.php';
session_start();
include 'includes/header.php'; 
?>

<section class="farmers-hero">
    <div class="container">
        <span class="text-uppercase text-muted fw-bold small tracking-wider mb-2 d-block">Our Partners</span>
        <h1 class="page-title animate-fade-in">Meet the Hands That Feed Us</h1>
        <p class="page-subtitle">
            Real people, real farms, real passion. We partner with over 50 local growers who share our commitment to organic, sustainable agriculture.
        </p>
    </div>
</section>

<div class="container mb-5 pb-5">
    <div class="row g-4 farmers-grid">
        
        <div class="col-md-4">
            <div class="farmer-profile-card">
                <div class="farmer-img-container">
                    <img src="./assets/images/Elena-Rodriguez-1080x1080-thumbn.jpg" alt="Elena Rodriguez">
                    <div class="farmer-img-overlay"></div>
                </div>
                <div class="farmer-content">
                    <span class="farmer-badge">Vegetables</span>
                    <h3 class="farmer-name">Elena Rodriguez</h3>
                    <div class="farmer-location">
                        <i class="bi bi-geo-alt-fill text-warning"></i> Green Valley Farms, CA
                    </div>
                    <p class="farmer-quote">
                        "We've been growing organic kale and spinach for three generations. The soil tells you what it needs if you listen."
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="farmer-profile-card">
                <div class="farmer-img-container">
                    <img src="./assets/images/chen.jpg" alt="David Chen">
                    <div class="farmer-img-overlay"></div>
                </div>
                <div class="farmer-content">
                    <span class="farmer-badge">Orchard Fruits</span>
                    <h3 class="farmer-name">David Chen</h3>
                    <div class="farmer-location">
                        <i class="bi bi-geo-alt-fill text-warning"></i> Sunrise Orchards, WA
                    </div>
                    <p class="farmer-quote">
                        "The secret to the perfect crisp apple isn't chemicals‚Äîit's patience, sunlight, and pruning at the exact right time."
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="farmer-profile-card">
                <div class="farmer-img-container">
                    <img src="./assets/images/sarah-miller.jpg" alt="Sarah Miller">
                    <div class="farmer-img-overlay"></div>
                </div>
                <div class="farmer-content">
                    <span class="farmer-badge">Dairy</span>
                    <h3 class="farmer-name">Sarah Miller</h3>
                    <div class="farmer-location">
                        <i class="bi bi-geo-alt-fill text-warning"></i> Happy Cows Dairy, WI
                    </div>
                    <p class="farmer-quote">
                        "Ethical farming means treating every animal like family. Happy cows genuinely do make better milk."
                    </p>
                </div>
            </div>
        </div>

    </div>
</div>

<?php include 'includes/footer.php'; ?>


================================================
FILE: fetch_products.php
================================================
<?php
include 'db.php';
session_start();

// 1. Get Filters from the AJAX request
$search = $_GET['search'] ?? '';
$category = $_GET['category'] ?? '';
$sort = $_GET['sort'] ?? '';
$page = isset($_GET['page']) ? (int)$_GET['page'] : 1;
$limit = 12; 
$offset = ($page - 1) * $limit;

// 2. Build Query
$sqlWhere = "WHERE 1=1";
$params = [];

if ($search) {
    $sqlWhere .= " AND name LIKE ?";
    $params[] = "%$search%";
}
if ($category && $category !== 'All') { // 'All' handles the reset
    $sqlWhere .= " AND category = ?";
    $params[] = $category;
}

// 3. Count Total (For Pagination)
$countSql = "SELECT COUNT(*) FROM products $sqlWhere";
$stmtCount = $pdo->prepare($countSql);
$stmtCount->execute($params);
$totalItems = $stmtCount->fetchColumn();
$totalPages = ceil($totalItems / $limit);

// 4. Fetch Products
$sql = "SELECT * FROM products $sqlWhere";

// Sorting
if ($sort === 'price_asc') {
    $sql .= " ORDER BY price ASC";
} elseif ($sort === 'price_desc') {
    $sql .= " ORDER BY price DESC";
} elseif ($sort === 'alpha') {
    $sql .= " ORDER BY name ASC";
} else {
    $sql .= " ORDER BY id DESC"; // Default
}

$sql .= " LIMIT $limit OFFSET $offset";
$stmt = $pdo->prepare($sql);
$stmt->execute($params);
$products = $stmt->fetchAll(PDO::FETCH_ASSOC);

// 5. Generate HTML Response
// We return a JSON object containing the Grid HTML and the Pagination HTML
$response = [];

// -- Part A: Product Grid HTML --
ob_start();
if (count($products) > 0) {
    foreach ($products as $product) {
        $imgName = $product['image'] ? $product['image'] : 'default.jpg';
        // Reuse your exact Card Design
        ?>
        <div class="col-6 col-md-4 col-lg-3">
            <div class="product-card">
                <div class="product-thumb">
                    <div class="card-badge-container">
                        <?php if($product['stock_qty'] < 5 && $product['stock_qty'] > 0): ?>
                            <span class="badge-pill badge-stock">Low Stock</span>
                        <?php endif; ?>
                        <span class="badge-pill badge-cat"><?= htmlspecialchars($product['category']) ?></span>
                    </div>
                    <a href="product.php?id=<?= $product['id'] ?>">
                        <img src="assets/images/<?= $imgName ?>" class="card-img-front" alt="<?= htmlspecialchars($product['name']) ?>">
                    </a>
                    <div class="card-action-overlay">
                        <?php if ($product['stock_qty'] > 0): ?>
                            <form action="add_to_cart.php" method="POST" class="add-cart-form">
                                <input type="hidden" name="product_id" value="<?= $product['id'] ?>">
                                <button type="submit" class="btn-quick-add" title="Add to Cart">
                                    <i class="bi bi-plus-lg fs-5"></i>
                                    <span>Add</span>
                                </button>
                            </form>
                        <?php else: ?>
                            <button class="btn-quick-add" disabled style="opacity: 0.5; cursor: not-allowed;">
                                <i class="bi bi-x-lg"></i>
                            </button>
                        <?php endif; ?>
                    </div>
                </div>
                <div class="product-details">
                    <a href="product.php?id=<?= $product['id'] ?>" class="product-title-link text-truncate">
                        <?= htmlspecialchars($product['name']) ?>
                    </a>
                    <div class="d-flex align-items-center justify-content-between">
                        <span class="product-price">$<?= number_format($product['price'], 2) ?></span>
                        <span class="product-unit">per unit</span>
                    </div>
                </div>
            </div>
        </div>
        <?php
    }
} else {
    ?>
    <div class="col-12 text-center py-5">
        <div class="bg-light rounded-4 p-5 border border-dashed">
            <i class="bi bi-search display-4 text-muted mb-3 d-block"></i>
            <h3 class="text-muted" style="font-family: var(--font-serif);">No products found.</h3>
            <p>We couldn't find what you were looking for.</p>
            <button onclick="resetFilters()" class="btn btn-primary rounded-pill mt-2">Clear Filters</button>
        </div>
    </div>
    <?php
}
$response['grid'] = ob_get_clean();

// -- Part B: Pagination HTML --
ob_start();
if ($totalPages > 1) {
    ?>
    <div class="pagination-wrapper">
        <div class="pagination-glass">
            <a href="#" class="page-btn page-arrow <?= ($page <= 1) ? 'disabled' : '' ?>" data-page="<?= $page - 1 ?>">
                <i class="bi bi-arrow-left"></i>
            </a>
            
            <?php for ($i = 1; $i <= $totalPages; $i++): ?>
                <a href="#" class="page-btn <?= ($i == $page) ? 'active' : '' ?>" data-page="<?= $i ?>">
                    <?= $i ?>
                </a>
            <?php endfor; ?>

            <a href="#" class="page-btn page-arrow <?= ($page >= $totalPages) ? 'disabled' : '' ?>" data-page="<?= $page + 1 ?>">
                <i class="bi bi-arrow-right"></i>
            </a>
        </div>
    </div>
    <?php
}
$response['pagination'] = ob_get_clean();

// Output JSON
header('Content-Type: application/json');
echo json_encode($response);
?>


================================================
FILE: fix_database.php
================================================
<?php
include 'db.php';

try {
    // 1. Fix Empty/Null Statuses -> Set to 'Pending'
    $sql1 = "UPDATE orders SET status = 'Pending' WHERE status IS NULL OR status = ''";
    $pdo->query($sql1);
    echo "‚úÖ Fixed empty statuses.<br>";

    // 2. Fix Lowercase Statuses -> Capitalize them (e.g. 'pending' -> 'Pending')
    $sql2 = "UPDATE orders SET status = 'Pending' WHERE status = 'pending'";
    $pdo->query($sql2);
    echo "‚úÖ Fixed lowercase statuses.<br>";
    
    echo "<hr><strong>üéâ Database Repair Complete!</strong><br>";
    echo "Go back to <a href='my_orders.php'>My Orders</a> to check.";

} catch (PDOException $e) {
    echo "Error: " . $e->getMessage();
}
?>


================================================
FILE: grocery_db.sql
================================================
-- phpMyAdmin SQL Dump
-- version 5.2.1
-- https://www.phpmyadmin.net/
--
-- Host: 127.0.0.1
-- Generation Time: Nov 21, 2025 at 01:52 PM
-- Server version: 11.6.2-MariaDB
-- PHP Version: 8.2.12

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Database: `grocery_db`
--

-- --------------------------------------------------------

--
-- Table structure for table `coupons`
--

CREATE TABLE `coupons` (
  `id` int(11) NOT NULL,
  `code` varchar(50) NOT NULL,
  `discount_percent` int(11) NOT NULL,
  `expiry_date` date NOT NULL,
  `status` varchar(20) DEFAULT 'Active'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `coupons`
--

INSERT INTO `coupons` (`id`, `code`, `discount_percent`, `expiry_date`, `status`) VALUES
(1, 'WELCOME20', 20, '2030-12-31', 'Active'),
(2, 'FRESH50', 50, '2030-12-31', 'Active');

-- --------------------------------------------------------

--
-- Table structure for table `orders`
--

CREATE TABLE `orders` (
  `id` int(11) NOT NULL,
  `user_id` int(11) DEFAULT NULL,
  `customer_name` varchar(100) NOT NULL,
  `address` text NOT NULL,
  `total_amount` decimal(10,2) NOT NULL,
  `status` varchar(50) DEFAULT 'Pending',
  `order_date` timestamp NULL DEFAULT current_timestamp(),
  `created_at` timestamp NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `orders`
--

INSERT INTO `orders` (`id`, `user_id`, `customer_name`, `address`, `total_amount`, `status`, `order_date`, `created_at`) VALUES
(1, 1, 'Janus Dominic', 'Maasin Zone 1-B, Zamboanga City', 0.50, 'Cancelled', '2025-11-20 12:13:57', '2025-11-19 12:40:04'),
(3, 1, 'Janus Dominic', 'Maasin', 1.70, 'Cancelled', '2025-11-21 07:16:12', '2025-11-16 12:40:04'),
(4, 1, 'Janus Dominic', 'AD', 3.50, 'Cancelled', '2025-11-21 07:32:59', '2025-11-21 12:40:04'),
(5, 1, 'Janus Dominic', 'THe BAby', 12.70, 'Cancelled', '2025-11-21 08:16:32', '2025-11-17 12:40:04'),
(6, 1, 'Janus Dominic', 'The Zamboanga', 12.70, 'Cancelled', '2025-11-21 08:49:23', '2025-11-20 12:40:04'),
(7, 1, 'Janus Dominic', '123', 1.36, 'Cancelled', '2025-11-21 09:38:27', '2025-11-21 12:40:04'),
(8, 1, 'addadad', 'adad', 0.50, 'Cancelled', '2025-11-21 10:12:25', '2025-11-15 12:40:04'),
(9, 1, 'Janus Dominic', 'Maasin', 5.00, 'Cancelled', '2025-11-21 11:25:37', '2025-11-19 12:40:04'),
(10, 1, 'Janus Dominic', 'Maasin', 0.50, 'Cancelled', '2025-11-21 11:27:32', '2025-11-15 12:40:04'),
(11, 1, 'Janus Dominic', 'Maasin', 0.50, 'Cancelled', '2025-11-21 11:30:38', '2025-11-17 12:40:04'),
(12, NULL, 'adad', 'adad', 1.80, 'Pending', '2025-11-21 12:03:24', '2025-11-18 12:40:04'),
(13, 2, 'Janus Dominic', 'Maasin', 12.30, 'Pending', '2025-11-21 12:39:24', '2025-11-18 12:40:04'),
(14, 2, 'Janus Dominic', 'Maasin', 22.80, 'Pending', '2025-11-21 12:40:38', '2025-11-21 12:40:38');

-- --------------------------------------------------------

--
-- Table structure for table `order_items`
--

CREATE TABLE `order_items` (
  `id` int(11) NOT NULL,
  `order_id` int(11) DEFAULT NULL,
  `product_id` int(11) DEFAULT NULL,
  `quantity` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `order_items`
--

INSERT INTO `order_items` (`id`, `order_id`, `product_id`, `quantity`) VALUES
(1, 1, 1, 1),
(3, 3, 1, 1),
(4, 3, 2, 1),
(5, 4, 3, 1),
(6, 5, 1, 1),
(7, 5, 2, 1),
(8, 5, 3, 1),
(9, 5, 4, 1),
(10, 5, 5, 1),
(11, NULL, 1, 1),
(12, NULL, 2, 1),
(13, NULL, 3, 1),
(14, NULL, 4, 1),
(15, NULL, 5, 1),
(16, 7, 1, 1),
(17, 7, 2, 1),
(18, 8, 1, 1),
(19, 9, 1, 10),
(20, 10, 1, 1),
(21, 11, 1, 1),
(22, 12, 100, 1),
(23, 13, 97, 1),
(24, 13, 98, 1),
(25, 13, 99, 1),
(26, 13, 100, 1),
(27, 14, 89, 1),
(28, 14, 90, 1),
(29, 14, 91, 1),
(30, 14, 98, 1),
(31, 14, 99, 1),
(32, 14, 100, 1);

-- --------------------------------------------------------

--
-- Table structure for table `products`
--

CREATE TABLE `products` (
  `id` int(11) NOT NULL,
  `name` varchar(100) NOT NULL,
  `price` decimal(10,2) NOT NULL,
  `image` varchar(255) DEFAULT 'default.jpg',
  `stock_qty` int(11) DEFAULT 0,
  `image_url` varchar(255) DEFAULT NULL,
  `category` varchar(50) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `products`
--

INSERT INTO `products` (`id`, `name`, `price`, `image`, `stock_qty`, `image_url`, `category`) VALUES
(1, 'Red Apple', 0.50, '69201ed03f11a.jpg', 491, NULL, 'Fruits'),
(2, 'Banana Bundle', 1.20, '69201ed5c07d2.jpg', 49, NULL, 'Fruits'),
(3, 'Whole Milk', 3.50, '69201edb24b83.jpg', 4, NULL, 'Dairy'),
(4, 'Sourdough Bread', 4.00, '69201ee1a7f8d.jpg', 14, NULL, 'Bakery'),
(5, 'Green Grapes', 3.50, '69201ee7876f3.jpg', 49, NULL, 'Fruits'),
(6, 'Green Apple', 0.55, 'p1.jpg', 100, NULL, 'Fruits'),
(7, 'Red Grapes', 3.50, 'p2.jpg', 50, NULL, 'Fruits'),
(8, 'Watermelon', 5.00, 'p3.jpg', 20, NULL, 'Fruits'),
(9, 'Pineapple', 3.20, 'p4.jpg', 30, NULL, 'Fruits'),
(10, 'Strawberries', 4.50, 'p5.jpg', 40, NULL, 'Fruits'),
(11, 'Blueberries', 4.99, 'p6.jpg', 45, NULL, 'Fruits'),
(12, 'Lemon', 0.40, 'p7.jpg', 150, NULL, 'Fruits'),
(13, 'Lime', 0.45, 'p8.jpg', 120, NULL, 'Fruits'),
(14, 'Peach', 1.10, 'p9.jpg', 60, NULL, 'Fruits'),
(15, 'Pear', 0.90, 'p10.jpg', 70, NULL, 'Fruits'),
(16, 'Cherry Pack', 6.00, 'p11.jpg', 25, NULL, 'Fruits'),
(17, 'Mango', 1.50, 'p12.jpg', 55, NULL, 'Fruits'),
(18, 'Avocado', 1.80, 'p13.jpg', 40, NULL, 'Vegetables'),
(19, 'Carrot Bag', 2.00, 'p14.jpg', 80, NULL, 'Vegetables'),
(20, 'Broccoli', 1.75, 'p15.jpg', 35, NULL, 'Vegetables'),
(21, 'Spinach', 2.50, 'p16.jpg', 40, NULL, 'Vegetables'),
(22, 'Cucumber', 0.80, 'p17.jpg', 90, NULL, 'Vegetables'),
(23, 'Tomato', 0.60, 'p18.jpg', 110, NULL, 'Vegetables'),
(24, 'Potato Bag', 4.50, 'p19.jpg', 60, NULL, 'Vegetables'),
(25, 'Onion Bag', 3.00, 'p20.jpg', 75, NULL, 'Vegetables'),
(26, 'Garlic', 0.50, 'p21.jpg', 200, NULL, 'Vegetables'),
(27, 'Bell Pepper (Red)', 1.20, 'p22.jpg', 50, NULL, 'Vegetables'),
(28, 'Bell Pepper (Green)', 1.00, 'p23.jpg', 55, NULL, 'Vegetables'),
(29, 'Lettuce', 1.50, 'p24.jpg', 40, NULL, 'Vegetables'),
(30, 'Cheddar Cheese', 5.50, 'p25.jpg', 30, NULL, 'Dairy'),
(31, 'Swiss Cheese', 6.00, 'p26.jpg', 25, NULL, 'Dairy'),
(32, 'Yogurt (Plain)', 1.00, 'p27.jpg', 100, NULL, 'Dairy'),
(33, 'Yogurt (Strawberry)', 1.00, 'p28.jpg', 100, NULL, 'Dairy'),
(34, 'Butter', 4.00, 'p29.jpg', 60, NULL, 'Dairy'),
(35, 'Cream Cheese', 2.50, 'p30.jpg', 45, NULL, 'Dairy'),
(36, 'Almond Milk', 3.80, 'p31.jpg', 40, NULL, 'Dairy'),
(37, 'Soy Milk', 3.60, 'p32.jpg', 40, NULL, 'Dairy'),
(38, 'Chocolate Milk', 2.50, 'p33.jpg', 50, NULL, 'Dairy'),
(39, 'Heavy Cream', 3.00, 'p34.jpg', 20, NULL, 'Dairy'),
(40, 'Sour Cream', 1.80, 'p35.jpg', 35, NULL, 'Dairy'),
(41, 'Whole Wheat Bread', 3.50, 'p36.jpg', 30, NULL, 'Bakery'),
(42, 'Bagels (6 Pack)', 4.00, 'p37.jpg', 25, NULL, 'Bakery'),
(43, 'Croissants (4 Pack)', 5.50, 'p38.jpg', 20, NULL, 'Bakery'),
(44, 'Donuts (Dozen)', 8.00, 'p39.jpg', 15, NULL, 'Bakery'),
(45, 'Muffins (Blueberry)', 4.50, 'p40.jpg', 20, NULL, 'Bakery'),
(46, 'Baguette', 2.00, 'p41.jpg', 40, NULL, 'Bakery'),
(47, 'Tortillas', 2.50, 'p42.jpg', 60, NULL, 'Bakery'),
(48, 'Hamburger Buns', 3.00, 'p43.jpg', 50, NULL, 'Bakery'),
(49, 'Hotdog Buns', 3.00, 'p44.jpg', 50, NULL, 'Bakery'),
(50, 'Chocolate Cake', 12.00, 'p45.jpg', 5, NULL, 'Bakery'),
(51, 'Chicken Breast', 8.50, 'p46.jpg', 30, NULL, 'Meat'),
(52, 'Ground Beef', 7.00, 'p47.jpg', 40, NULL, 'Meat'),
(53, 'Steak', 15.00, 'p48.jpg', 15, NULL, 'Meat'),
(54, 'Pork Chops', 9.00, 'p49.jpg', 25, NULL, 'Meat'),
(55, 'Bacon', 6.50, 'p50.jpg', 50, NULL, 'Meat'),
(56, 'Sausages', 5.50, 'p51.jpg', 45, NULL, 'Meat'),
(57, 'Salmon Fillet', 12.00, 'p52.jpg', 20, NULL, 'Meat'),
(58, 'Shrimp', 14.00, 'p53.jpg', 25, NULL, 'Meat'),
(59, 'Tuna Can', 1.50, 'p54.jpg', 150, NULL, 'Meat'),
(60, 'Turkey Slices', 5.00, 'p55.jpg', 40, NULL, 'Meat'),
(61, 'Potato Chips', 3.00, 'p56.jpg', 80, NULL, 'Snacks'),
(62, 'Pretzels', 2.50, 'p57.jpg', 70, NULL, 'Snacks'),
(63, 'Popcorn', 2.00, 'p58.jpg', 60, NULL, 'Snacks'),
(64, 'Chocolate Bar', 1.20, 'p59.jpg', 200, NULL, 'Snacks'),
(65, 'Gummy Bears', 1.50, 'p60.jpg', 100, NULL, 'Snacks'),
(66, 'Cookies', 3.50, 'p61.jpg', 50, NULL, 'Snacks'),
(67, 'Crackers', 2.80, 'p62.jpg', 60, NULL, 'Snacks'),
(68, 'Trail Mix', 4.50, 'p63.jpg', 40, NULL, 'Snacks'),
(69, 'Granola Bars', 3.80, 'p64.jpg', 55, NULL, 'Snacks'),
(70, 'Beef Jerky', 6.00, 'p65.jpg', 30, NULL, 'Snacks'),
(71, 'Soda (Cola)', 1.50, 'p66.jpg', 100, NULL, 'Beverages'),
(72, 'Soda (Lemon)', 1.50, 'p67.jpg', 100, NULL, 'Beverages'),
(73, 'Water Bottle', 1.00, 'p68.jpg', 200, NULL, 'Beverages'),
(74, 'Sparkling Water', 1.20, 'p69.jpg', 150, NULL, 'Beverages'),
(75, 'Iced Tea', 2.00, 'p70.jpg', 80, NULL, 'Beverages'),
(76, 'Lemonade', 2.50, 'p71.jpg', 60, NULL, 'Beverages'),
(77, 'Energy Drink', 3.00, 'p72.jpg', 50, NULL, 'Beverages'),
(78, 'Coffee Beans', 12.00, 'p73.jpg', 30, NULL, 'Beverages'),
(79, 'Green Tea Box', 4.00, 'p74.jpg', 40, NULL, 'Beverages'),
(80, 'Apple Juice', 3.50, 'p75.jpg', 50, NULL, 'Beverages'),
(81, 'Pasta', 1.50, 'p76.jpg', 100, NULL, 'Pantry'),
(82, 'Rice (5lb)', 6.00, 'p77.jpg', 40, NULL, 'Pantry'),
(83, 'Tomato Sauce', 2.00, 'p78.jpg', 80, NULL, 'Pantry'),
(84, 'Olive Oil', 8.00, 'p79.jpg', 30, NULL, 'Pantry'),
(85, 'Vegetable Oil', 4.00, 'p80.jpg', 40, NULL, 'Pantry'),
(86, 'Flour', 3.00, 'p81.jpg', 50, NULL, 'Pantry'),
(87, 'Sugar', 2.50, 'p82.jpg', 60, NULL, 'Pantry'),
(88, 'Salt', 1.00, 'p83.jpg', 100, NULL, 'Pantry'),
(89, 'Pepper', 3.00, 'p84.jpg', 79, NULL, 'Pantry'),
(90, 'Honey', 6.50, 'p85.jpg', 34, NULL, 'Pantry'),
(91, 'Peanut Butter', 4.00, 'p86.jpg', 49, NULL, 'Pantry'),
(92, 'Jam (Strawberry)', 3.50, 'p87.jpg', 45, NULL, 'Pantry'),
(93, 'Ketchup', 2.50, 'p88.jpg', 70, NULL, 'Pantry'),
(94, 'Mustard', 2.00, 'p89.jpg', 75, NULL, 'Pantry'),
(95, 'Mayonnaise', 3.50, 'p90.jpg', 50, NULL, 'Pantry'),
(96, 'Cereal', 4.50, 'p91.jpg', 60, NULL, 'Pantry'),
(97, 'Oatmeal', 3.00, 'p92.jpg', 54, NULL, 'Pantry'),
(98, 'Pancake Mix', 3.50, 'p93.jpg', 38, NULL, 'Pantry'),
(99, 'Syrup', 4.00, 'p94.jpg', 43, NULL, 'Pantry'),
(100, 'Soup Can', 1.80, 'p95.jpg', 97, NULL, 'Pantry'),
(101, 'The Apple', 11.00, '69205ee998415.jpg', 2, NULL, 'Fruits');

-- --------------------------------------------------------

--
-- Table structure for table `reviews`
--

CREATE TABLE `reviews` (
  `id` int(11) NOT NULL,
  `product_id` int(11) NOT NULL,
  `user_id` int(11) NOT NULL,
  `rating` int(11) NOT NULL,
  `comment` text DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `users`
--

CREATE TABLE `users` (
  `id` int(11) NOT NULL,
  `full_name` varchar(255) NOT NULL,
  `email` varchar(255) NOT NULL,
  `password` varchar(255) NOT NULL,
  `address` text DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `users`
--

INSERT INTO `users` (`id`, `full_name`, `email`, `password`, `address`, `created_at`) VALUES
(2, 'Janus Dominic', 'janusdominic0@gmail.com', '$2y$10$BHJby08kX2GjWffDCng9DeClUPACH.F7IKcWr0m1oQHKVNubFhWBK', 'Maasin', '2025-11-21 12:39:13');

--
-- Indexes for dumped tables
--

--
-- Indexes for table `coupons`
--
ALTER TABLE `coupons`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `code` (`code`);

--
-- Indexes for table `orders`
--
ALTER TABLE `orders`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `order_items`
--
ALTER TABLE `order_items`
  ADD PRIMARY KEY (`id`),
  ADD KEY `order_id` (`order_id`),
  ADD KEY `product_id` (`product_id`);

--
-- Indexes for table `products`
--
ALTER TABLE `products`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `reviews`
--
ALTER TABLE `reviews`
  ADD PRIMARY KEY (`id`),
  ADD KEY `product_id` (`product_id`),
  ADD KEY `user_id` (`user_id`);

--
-- Indexes for table `users`
--
ALTER TABLE `users`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `email` (`email`);

--
-- AUTO_INCREMENT for dumped tables
--

--
-- AUTO_INCREMENT for table `coupons`
--
ALTER TABLE `coupons`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=3;

--
-- AUTO_INCREMENT for table `orders`
--
ALTER TABLE `orders`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=15;

--
-- AUTO_INCREMENT for table `order_items`
--
ALTER TABLE `order_items`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=33;

--
-- AUTO_INCREMENT for table `products`
--
ALTER TABLE `products`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=102;

--
-- AUTO_INCREMENT for table `reviews`
--
ALTER TABLE `reviews`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=257;

--
-- AUTO_INCREMENT for table `users`
--
ALTER TABLE `users`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=3;

--
-- Constraints for dumped tables
--

--
-- Constraints for table `order_items`
--
ALTER TABLE `order_items`
  ADD CONSTRAINT `order_items_ibfk_1` FOREIGN KEY (`order_id`) REFERENCES `orders` (`id`),
  ADD CONSTRAINT `order_items_ibfk_2` FOREIGN KEY (`product_id`) REFERENCES `products` (`id`);

--
-- Constraints for table `reviews`
--
ALTER TABLE `reviews`
  ADD CONSTRAINT `reviews_ibfk_1` FOREIGN KEY (`product_id`) REFERENCES `products` (`id`) ON DELETE CASCADE,
  ADD CONSTRAINT `reviews_ibfk_2` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE;
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;



================================================
FILE: index.php
================================================
<?php
include 'db.php';

// Check if a session is already active before starting one
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

// --- FORCE LOGOUT CHECK ---
if (isset($_SESSION['user_id'])) {
    $stmtCheck = $pdo->prepare("SELECT id FROM users WHERE id = ?");
    $stmtCheck->execute([$_SESSION['user_id']]);
    if (!$stmtCheck->fetch()) {
        session_destroy();
        header("Location: index.php");
        exit;
    }
}

// Cart Count
$cartCount = isset($_SESSION['cart']) ? array_sum($_SESSION['cart']) : 0;

// --- PAGINATION & FILTER LOGIC ---
$limit = 12; 
$page = isset($_GET['page']) ? (int)$_GET['page'] : 1;
if ($page < 1) $page = 1;
$offset = ($page - 1) * $limit;

$search = $_GET['search'] ?? '';
$category = $_GET['category'] ?? '';
$sort = $_GET['sort'] ?? '';

// Build Query
$sqlWhere = "WHERE 1=1";
$params = [];

if ($search) {
    $sqlWhere .= " AND name LIKE ?";
    $params[] = "%$search%";
}
if ($category) {
    $sqlWhere .= " AND category = ?";
    $params[] = $category;
}

// Count Total
$countSql = "SELECT COUNT(*) FROM products $sqlWhere";
$stmtCount = $pdo->prepare($countSql);
$stmtCount->execute($params);
$totalItems = $stmtCount->fetchColumn();
$totalPages = ceil($totalItems / $limit);

// Fetch Items
$sql = "SELECT * FROM products $sqlWhere";
if ($sort === 'price_asc') {
    $sql .= " ORDER BY price ASC";
} elseif ($sort === 'price_desc') {
    $sql .= " ORDER BY price DESC";
} elseif ($sort === 'alpha') {
    $sql .= " ORDER BY name ASC";
} else {
    $sql .= " ORDER BY id DESC";
}

$sql .= " LIMIT $limit OFFSET $offset";
$stmt = $pdo->prepare($sql);
$stmt->execute($params);
$products = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Fetch Categories for Filter
$catStmt = $pdo->query("SELECT DISTINCT category FROM products ORDER BY category");
$categories = $catStmt->fetchAll(PDO::FETCH_COLUMN);
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <title>FreshCart Market | Organic & Fresh</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css?v=<?php echo time(); ?>">
</head>
<body>
    <div class="bg-dark text-white text-center py-2 small fw-bold" style="letter-spacing: 0.05em;">
        ‚ö° FLASH SALE: Use code <span class="text-warning border-bottom border-warning" style="cursor:pointer;" onclick="navigator.clipboard.writeText('FRESH50'); alert('Code FRESH50 copied!');">FRESH50</span> for 50% OFF your first order!
    </div>
    
    <nav class="navbar navbar-expand-lg navbar-glass sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.php">
                <h3 class="m-0" style="font-family: var(--font-serif); letter-spacing: -0.05em; font-weight: 800;">
                    FreshCart<span style="color: var(--accent-color)">.</span>
                </h3>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navContent">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navContent">
                <ul class="navbar-nav ms-auto align-items-center gap-3">
                    <?php if (isset($_SESSION['user_id'])): ?>
                        <li class="nav-item">
                            <a class="nav-link-custom d-flex align-items-center gap-2" href="profile.php">
                                <div class="bg-dark text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; font-size: 0.8rem;">
                                    <?= strtoupper(substr($_SESSION['user_name'], 0, 1)) ?>
                                </div>
                                <span><?= htmlspecialchars($_SESSION['user_name']) ?></span>
                            </a>
                        </li>
                    <?php else: ?>
                        <li class="nav-item"><a href="user_login.php" class="nav-link-custom">Login</a></li>
                        <li class="nav-item"><a href="user_register.php" class="btn btn-primary rounded-pill px-4 shadow-sm">Sign Up</a></li>
                    <?php endif; ?>

                    <li class="nav-item position-relative">
                        <a href="cart.php" class="btn btn-outline-secondary border-0 position-relative">
                            <i class="bi bi-bag" style="font-size: 1.3rem;"></i>
                            <?php if($cartCount > 0): ?>
                                <span id="cart-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger border border-light" style="font-size: 0.65rem;">
                                    <?= $cartCount ?>
                                </span>
                            <?php endif; ?>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <header class="hero-wrapper">
        <div class="container hero-content">
            <div class="row align-items-center">
                
                <div class="col-lg-6 mb-5 mb-lg-0">
                    <?php if (isset($_SESSION['user_id'])): ?>
                        <div class="welcome-badge">
                            <i class="bi bi-basket-fill"></i> 
                            <span>Welcome back, <strong><?= htmlspecialchars($_SESSION['user_name']) ?></strong>!</span>
                        </div>
                        <h1 class="hero-display-text animate-fade-in">Restock your<br>kitchen favorites.</h1>
                        <p class="hero-lead">Your pantry looks a little empty. Let's fill it up with fresh, organic goodness delivered by tomorrow.</p>
                    <?php else: ?>
                        <span class="text-uppercase text-success fw-bold small mb-2 d-block tracking-wider"><i class="bi bi-patch-check-fill me-1"></i> Certified Organic</span>
                        <h1 class="hero-display-text animate-fade-in">Groceries made,<br> much more easier</h1>
                        <p class="hero-lead">Skip the line and get farm-fresh produce delivered to your door. Quality you can taste, convenience you'll love.</p>
                    <?php endif; ?>
                    
                    <div class="d-flex gap-3">
                        <a href="#shop" class="btn btn-primary btn-lg rounded-pill px-5 shadow-sm">Start Shopping</a>
                        <a href="#categories" class="btn btn-outline-secondary btn-lg rounded-pill px-4">Browse Aisles</a>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="hero-image-container">
                        <img src="assets/images/gulay.jpg" id="dynamic-hero-img" class="hero-img-front" alt="Fresh Grocery Bag">
                        
                        <div class="floating-card card-1">
                            <i class="bi bi-star-fill text-warning"></i> 4.9 Rating
                        </div>
                        <div class="floating-card card-2">
                            <i class="bi bi-truck text-success"></i> Free Delivery
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </header>

    <div class="container search-capsule-container" id="shop">
        <div class="row justify-content-center">
            <div class="col-xl-10">
                <form id="filterForm" class="search-capsule" onsubmit="return false;">
                    <div class="capsule-input-group">
                        <label class="capsule-label">Search</label>
                        <input type="text" id="searchInput" class="capsule-input" placeholder="Apple, Milk, Bread..." value="<?= htmlspecialchars($search) ?>">
                    </div>
                    <div class="search-divider d-none d-md-block"></div>
                    <div class="capsule-input-group">
                        <label class="capsule-label">Sort By</label>
                        <select id="sortSelect" class="capsule-select">
                            <option value="">Newest First</option>
                            <option value="price_asc">Price: Low to High</option>
                            <option value="price_desc">Price: High to Low</option>
                            <option value="alpha">Name: A-Z</option>
                        </select>
                    </div>
                    <!-- <button type="button" class="btn-capsule-search" onclick="fetchData()">
                        <i class="bi bi-search fs-5"></i>
                    </button> -->
                </form>
            </div>
        </div>
    </div>

    <div class="container mt-5 pt-2" id="categories">
        
        <div class="category-rail-wrapper text-center text-md-start" id="categoryRail">
            <button class="cat-chip active" data-category="All">All Items</button>
            <?php foreach ($categories as $cat): ?>
                <button class="cat-chip" data-category="<?= htmlspecialchars($cat) ?>">
                    <?= htmlspecialchars($cat) ?>
                </button>
            <?php endforeach; ?>
        </div>

        <div class="row g-4" id="product-grid">
            <?php 
               if (count($products) > 0) {
                   foreach ($products as $product) {
                       $imgName = $product['image'] ? $product['image'] : 'default.jpg';
                       echo '<div class="col-6 col-md-4 col-lg-3"><div class="product-card"><div class="product-thumb"><div class="card-badge-container">';
                       if($product['stock_qty'] < 5 && $product['stock_qty'] > 0) echo '<span class="badge-pill badge-stock">Low Stock</span>';
                       echo '<span class="badge-pill badge-cat">'.htmlspecialchars($product['category']).'</span></div>';
                       echo '<a href="product.php?id='.$product['id'].'"><img src="assets/images/'.$imgName.'" class="card-img-front" alt="'.htmlspecialchars($product['name']).'"></a>';
                       echo '<div class="card-action-overlay">';
                       if ($product['stock_qty'] > 0) {
                           echo '<form action="add_to_cart.php" method="POST" class="add-cart-form"><input type="hidden" name="product_id" value="'.$product['id'].'"><button type="submit" class="btn-quick-add"><i class="bi bi-plus-lg fs-5"></i><span>Add</span></button></form>';
                       } else {
                           echo '<button class="btn-quick-add" disabled style="opacity:0.5"><i class="bi bi-x-lg"></i></button>';
                       }
                       echo '</div></div><div class="product-details"><a href="product.php?id='.$product['id'].'" class="product-title-link text-truncate">'.htmlspecialchars($product['name']).'</a><div class="d-flex align-items-center justify-content-between"><span class="product-price">$'.number_format($product['price'], 2).'</span><span class="product-unit">per unit</span></div></div></div></div>';
                   }
               } else {
                   echo '<div class="col-12 text-center py-5"><h3 class="text-muted">No products found.</h3></div>';
               }
            ?>
        </div>

        <div id="pagination-container" class="mt-5 mb-5">
            <?php if ($totalPages > 1): ?>
                <div class="pagination-wrapper">
                    <div class="pagination-glass">
                        <a href="#" class="page-btn page-arrow <?= ($page <= 1) ? 'disabled' : '' ?>" data-page="<?= max(1, $page-1) ?>"><i class="bi bi-arrow-left"></i></a>
                        <?php for ($i = 1; $i <= $totalPages; $i++): ?>
                            <a href="#" class="page-btn <?= ($i == $page) ? 'active' : '' ?>" data-page="<?= $i ?>"><?= $i ?></a>
                        <?php endfor; ?>
                        <a href="#" class="page-btn page-arrow <?= ($page >= $totalPages) ? 'disabled' : '' ?>" data-page="<?= min($totalPages, $page+1) ?>"><i class="bi bi-arrow-right"></i></a>
                    </div>
                </div>
            <?php endif; ?>
        </div>

    </div>

    <footer class="site-footer">
        <div class="container">
            <div class="row g-5">
                
                <div class="col-lg-4 col-md-6">
                    <a href="index.php" class="text-decoration-none">
                        <span class="footer-brand">FreshCart<span style="color: var(--accent-color)">.</span></span>
                    </a>
                    <p class="text-muted small lh-lg mb-4">
                        Delivering nature's best to your doorstep. We partner directly with local organic farmers to ensure freshness, sustainability, and fair trade practices.
                    </p>
                    <div class="d-flex">
                        <a href="https://www.facebook.com/notagirlgamer69" target="_blank" class="social-icon-link"><i class="bi bi-facebook"></i></a>
                        <a href="https://www.instagram.com/janusinss/" target="_blank" class="social-icon-link"><i class="bi bi-instagram"></i></a>
                        <a href="https://x.com/Syrupynut" target="_blank" class="social-icon-link"><i class="bi bi-twitter"></i></a>
                        <a href="https://www.linkedin.com/in/janusdominic/" target="_blank" class="social-icon-link"><i class="bi bi-linkedin"></i></a>
                    </div>
                </div>

                <div class="col-lg-2 col-md-3 col-6">
                    <h6 class="footer-heading">Shop</h6>
                    <ul class="list-unstyled footer-link-list">
                        <li><a href="#shop" class="footer-link">All Products</a></li>
                        <li><a href="#categories" class="footer-link">Fresh Produce</a></li>
                        <li><a href="#categories" class="footer-link">Dairy & Eggs</a></li>
                        <li><a href="#categories" class="footer-link">Bakery</a></li>
                    </ul>
                </div>

                <div class="col-lg-2 col-md-3 col-6">
                    <h6 class="footer-heading">Company</h6>
                    <ul class="list-unstyled footer-link-list">
                        <li><a href="about.php" class="footer-link">About Us</a></li>
                        <li><a href="sustainability.php" class="footer-link">Sustainability</a></li>
                        <li><a href="farmers.php" class="footer-link">Farmers</a></li>
                        <li><a href="contact.php" class="footer-link">Contact</a></li>
                    </ul>
                </div>

                <div class="col-lg-4 col-md-12">
                    <h6 class="footer-heading">Stay Fresh</h6>
                    <p class="small text-muted mb-3">Join our newsletter for exclusive organic deals and recipes.</p>
                    
                    <form action="#">
                        <div class="footer-newsletter-group">
                            <input type="email" class="footer-email-input" placeholder="Your email address">
                            <button class="footer-subscribe-btn" type="button">Join</button>
                        </div>
                    </form>

                    <div class="mt-4">
                        <p class="small text-muted mb-2">Secure Payment</p>
                        <div class="d-flex flex-wrap">
                            <span class="payment-badge">VISA</span>
                            <span class="payment-badge">MasterCard</span>
                            <span class="payment-badge">PayPal</span>
                            <span class="payment-badge">GCash</span>
                        </div>
                    </div>
                </div>

            </div>

            <div class="border-top mt-5 pt-4 d-flex flex-column flex-md-row justify-content-between align-items-center">
                <small class="text-muted mb-2 mb-md-0">&copy; 2025 FreshCart Market. Student Project by <span style="color: var(--accent-color); text-transform: uppercase; font-weight: bold">Janus Dominic</span>.</small>
                <div class="small text-muted">
                    <a href="privacy_policy.php" class="text-decoration-none text-muted fw-bold me-3">Privacy Policy</a>
                    <a href="terms_of_service.php" class="text-decoration-none text-muted fw-bold">Terms of Service</a>
                </div>
            </div>
        </div>
    </footer>

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="liveToast" class="toast align-items-center text-bg-dark border-0 rounded-4 shadow-lg" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex p-2">
                <div class="toast-body d-flex align-items-center gap-2">
                    <i class="bi bi-bag-check-fill text-success fs-5"></i>
                    <span>Item added to cart!</span>
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // IMAGES: Make sure these exist in 'assets/images/'
            const heroImages = [
                "assets/images/gulay.jpg",       
                "assets/images/gulay1.jpg", 
                "assets/images/gulay2.jpg",    
                "assets/images/gulay3.jpg"   
            ];

            let currentIndex = 0;
            const imgElement = document.getElementById('dynamic-hero-img');

            if (imgElement && heroImages.length > 1) {
                setInterval(() => {
                    imgElement.classList.add('changing');
                    setTimeout(() => {
                        currentIndex = (currentIndex + 1) % heroImages.length;
                        imgElement.src = heroImages[currentIndex];
                        imgElement.onload = () => { imgElement.classList.remove('changing'); };
                        setTimeout(() => imgElement.classList.remove('changing'), 100);
                    }, 500); 
                }, 3000); 
            }
        });
    </script>

    <script>
        let currentCategory = '<?= $category ?: "All" ?>';
        let currentSearch = '<?= $search ?>';
        let currentSort = '<?= $sort ?>';
        let currentPage = 1;

        document.addEventListener("DOMContentLoaded", () => {
            // Category Chips Click
            const catButtons = document.querySelectorAll('#categoryRail .cat-chip');
            catButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    catButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentCategory = btn.getAttribute('data-category');
                    currentPage = 1; 
                    fetchData();
                });
            });

            // Search Input
            const searchInput = document.getElementById('searchInput');
            let timeout = null;
            searchInput.addEventListener('input', function() {
                clearTimeout(timeout);
                timeout = setTimeout(() => {
                    currentSearch = this.value;
                    currentPage = 1;
                    fetchData();
                }, 500); 
            });

            // Sort Select
            const sortSelect = document.getElementById('sortSelect');
            sortSelect.addEventListener('change', function() {
                currentSort = this.value;
                fetchData();
            });
        });

        function fetchData() {
            const grid = document.getElementById('product-grid');
            const pagination = document.getElementById('pagination-container');
            grid.style.opacity = '0.5';

            const params = new URLSearchParams({
                category: currentCategory,
                search: currentSearch,
                sort: currentSort,
                page: currentPage
            });

            fetch('fetch_products.php?' + params.toString())
                .then(response => response.json())
                .then(data => {
                    grid.innerHTML = data.grid;
                    pagination.innerHTML = data.pagination;
                    attachPaginationListeners();
                    grid.style.opacity = '1';
                })
                .catch(error => console.error('Error:', error));
        }

        function attachPaginationListeners() {
            const pageBtns = document.querySelectorAll('.page-btn');
            pageBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if(btn.classList.contains('disabled')) return;
                    const newPage = btn.getAttribute('data-page');
                    if(newPage) {
                        currentPage = newPage;
                        fetchData();
                        document.getElementById('categories').scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
        }

        function resetFilters() {
            document.getElementById('searchInput').value = '';
            currentSearch = '';
            currentCategory = 'All';
            document.querySelectorAll('.cat-chip').forEach(b => b.classList.remove('active'));
            document.querySelector('.cat-chip[data-category="All"]').classList.add('active');
            fetchData();
        }

        attachPaginationListeners();
    </script>

    <script>
        document.addEventListener('submit', function(e) {
            if (e.target && e.target.classList.contains('add-cart-form')) {
                e.preventDefault();
                const formData = new FormData(e.target);
                fetch('add_to_cart.php', { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        const badge = document.getElementById('cart-badge');
                        if (badge) badge.innerText = data.cart_count;
                        else location.reload();
                        const toast = new bootstrap.Toast(document.getElementById('liveToast'));
                        toast.show();
                    } else if (data.status === 'login_required') {
                        window.location.href = 'user_login.php';
                    } else {
                        alert(data.message);
                    }
                });
            }
        });
    </script>

</body>
</html>


================================================
FILE: login.php
================================================
<?php
session_start();

// If already logged in, go to dashboard
if (isset($_SESSION['admin_logged_in']) && $_SESSION['admin_logged_in'] === true) {
    header("Location: admin.php");
    exit;
}

$error = '';

if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    $username = $_POST['username'];
    $password = $_POST['password'];

    // SIMPLE HARDCODED CREDENTIALS
    // You can change these to whatever you want
    if ($username === 'admin' && $password === 'admin123') {
        $_SESSION['admin_logged_in'] = true;
        header("Location: admin.php");
        exit;
    } else {
        $error = "Invalid username or password!";
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Admin Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        body { background-color: #f5f5f5; height: 100vh; display: flex; align-items: center; justify-content: center; }
        .login-card { width: 100%; max-width: 400px; padding: 2rem; border-radius: 10px; }
    </style>
</head>
<body>

    <div class="card login-card shadow">
        <h3 class="text-center mb-4">üîí Admin Login</h3>
        
        <?php if ($error): ?>
            <div class="alert alert-danger"><?= $error ?></div>
        <?php endif; ?>

        <form method="POST">
            <div class="mb-3">
                <label>Username</label>
                <input type="text" name="username" class="form-control" required autofocus>
            </div>
            <div class="mb-3">
                <label>Password</label>
                <input type="password" name="password" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Login</button>
        </form>
        
        <div class="text-center mt-3">
            <a href="index.php" class="text-decoration-none">‚Üê Back to Shop</a>
        </div>
    </div>

</body>
</html>


================================================
FILE: logout.php
================================================
<?php
session_start();
session_destroy();
header("Location: login.php");
exit;
?>


================================================
FILE: my_orders.php
================================================
<?php
include 'db.php';
session_start();
// Security Check: Must be logged in
if (!isset($_SESSION['user_id'])) {
    header("Location: user_login.php");
    exit;
}

$user_id = $_SESSION['user_id'];
// Fetch orders for THIS user only
$stmt = $pdo->prepare("SELECT * FROM orders WHERE user_id = ? ORDER BY id DESC");
$stmt->execute([$user_id]);
$orders = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <title>My Orders | FreshCart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css?v=<?php echo time(); ?>">
</head>
<body class="container mt-5 mb-5">

    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h2 class="m-0" style="font-family: var(--font-serif); font-weight: 700;">My Orders</h2>
            <p class="text-muted m-0">Track your past purchases and returns.</p>
        </div>
        <a href="index.php" class="btn btn-outline-secondary rounded-pill px-4">
            <i class="bi bi-arrow-left me-2"></i> Back to Shop
        </a>
    </div>

    <?php if (isset($_GET['msg']) && $_GET['msg'] == 'cancelled'): ?>
        <div class="alert alert-warning border-0 shadow-sm rounded-3 mb-4 d-flex align-items-center">
            <i class="bi bi-check-circle-fill me-2 fs-5"></i>
            <div>Order successfully cancelled.</div>
        </div>
    <?php endif; ?>

    <?php if (count($orders) > 0): ?>
        <div class="row">
            <?php foreach ($orders as $order): ?>
                <div class="col-md-12">
                    
                    <div class="order-card">
                        <div class="order-header">
                            <div class="d-flex align-items-center gap-3">
                                <div class="bg-white border rounded-circle d-flex align-items-center justify-content-center" style="width: 45px; height: 45px;">
                                    <i class="bi bi-box-seam text-secondary fs-5"></i>
                                </div>
                                <div>
                                    <span class="order-id">#<?= str_pad($order['id'], 6, "0", STR_PAD_LEFT) ?></span>
                                    <div class="order-date">
                                        <i class="bi bi-calendar3"></i> 
                                        <?= date('M d, Y ‚Ä¢ h:i A', strtotime($order['created_at'])) ?>
                                    </div>
                                </div>
                            </div>

                            <?php 
                                $status = $order['status'] ?: 'Pending';
                                $badgeClass = 'status-pending';
                                $icon = 'bi-hourglass-split';

                                if ($status == 'Shipped') { $badgeClass = 'status-shipped'; $icon = 'bi-truck'; }
                                if ($status == 'Delivered') { $badgeClass = 'status-delivered'; $icon = 'bi-check-circle-fill'; }
                                if ($status == 'Cancelled') { $badgeClass = 'status-cancelled'; $icon = 'bi-x-circle-fill'; }
                            ?>
                            <div class="status-pill <?= $badgeClass ?>">
                                <i class="bi <?= $icon ?>"></i> <?= $status ?>
                            </div>
                        </div>

                        <div class="order-body">
                            <div class="row align-items-center">
                                
                                <div class="col-md-3 mb-3 mb-md-0">
                                    <span class="order-info-label">Total Amount</span>
                                    <div class="order-total-price">$<?= number_format($order['total_amount'], 2) ?></div>
                                </div>

                                <div class="col-md-5 mb-3 mb-md-0">
                                    <span class="order-info-label">Delivery Address</span>
                                    <div class="order-address text-truncate">
                                        <i class="bi bi-geo-alt-fill text-muted me-1"></i>
                                        <?= htmlspecialchars($order['address']) ?>
                                    </div>
                                </div>

                                <div class="col-md-4 text-md-end d-flex flex-column align-items-end gap-2">
                                    
                                    <a href="user_order_details.php?order_id=<?= $order['id'] ?>" class="btn btn-light rounded-circle border" title="View Details">
                                        <i class="bi bi-chevron-right"></i>
                                    </a>

                                    <?php if ($status == 'Pending'): ?>
                                        <form action="user_cancel_order.php" method="POST" onsubmit="return confirm('Are you sure you want to cancel this order?');">
                                            <input type="hidden" name="order_id" value="<?= $order['id'] ?>">
                                            <button type="submit" class="btn btn-outline-danger rounded-pill px-4 btn-sm">
                                                Cancel Order
                                            </button>
                                        </form>
                                    <?php endif; ?>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            <?php endforeach; ?>
        </div>

    <?php else: ?>
        
        <div class="empty-orders-container animate-fade-in">
            <i class="bi bi-cart-x empty-orders-icon"></i>
            <h3 style="font-family: var(--font-serif);">No orders yet</h3>
            <p class="text-muted mb-4">You haven't placed any orders yet. Fill your pantry with fresh goodness!</p>
            <a href="index.php" class="btn btn-primary rounded-pill px-5 py-3 shadow-sm">Start Shopping</a>
        </div>

    <?php endif; ?>

</body>
</html>


================================================
FILE: order_details.php
================================================
<?php
include 'db.php';
session_start();

// Security Check
if (!isset($_SESSION['admin_logged_in']) || $_SESSION['admin_logged_in'] !== true) {
    header("Location: login.php");
    exit;
}

if (!isset($_GET['order_id'])) {
    die("Order ID missing.");
}

$order_id = $_GET['order_id'];

// Handle Status Update
if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['update_status'])) {
    $new_status = $_POST['status'];
    $stmtUpdate = $pdo->prepare("UPDATE orders SET status = ? WHERE id = ?");
    $stmtUpdate->execute([$new_status, $order_id]);
    
    // CHANGED: Redirect to main admin router with the "Orders" view active and a success message
    header("Location: admin.php?view=orders&msg=updated");
    exit;
}

// Fetch Data
try {
    $stmt = $pdo->prepare("SELECT * FROM orders WHERE id = ?");
    $stmt->execute([$order_id]);
    $order = $stmt->fetch(PDO::FETCH_ASSOC);

    if (!$order) { die("Order not found!"); }

    $sqlItems = "SELECT order_items.*, products.name, products.price, products.image 
                 FROM order_items 
                 JOIN products ON order_items.product_id = products.id 
                 WHERE order_items.order_id = ?";
    $stmtItems = $pdo->prepare($sqlItems);
    $stmtItems->execute([$order_id]);
    $items = $stmtItems->fetchAll(PDO::FETCH_ASSOC);

} catch (Exception $e) {
    die("Error: " . $e->getMessage());
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Order #<?= $order_id ?> | Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
</head>
<body style="background-color: var(--bg-color);">

    <div class="container mt-5 order-details-wrapper">

        <div class="page-nav-header animate-fade-in">
            <a href="admin.php" class="btn-back-glass">
                <i class="bi bi-arrow-left"></i> Back to Dashboard
            </a>
        </div>

        <div class="invoice-card animate-fade-in">
            
            <div class="invoice-header-modern">
                <div>
                    <h1 class="invoice-title">Order #<?= str_pad($order['id'], 5, '0', STR_PAD_LEFT) ?></h1>
                    <div class="invoice-meta">
                        <span><i class="bi bi-calendar3"></i> <?= date('M d, Y', strtotime($order['created_at'])) ?></span>
                        <span><i class="bi bi-clock"></i> <?= date('h:i A', strtotime($order['created_at'])) ?></span>
                    </div>
                </div>
                
                <?php 
                    $s = $order['status'];
                    $badgeStyle = 'background: #eee; color: #555;'; // Default
                    if ($s == 'Pending') $badgeStyle = 'background: #fff3cd; color: #856404; border: 1px solid #ffeeba;';
                    if ($s == 'Shipped') $badgeStyle = 'background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb;';
                    if ($s == 'Delivered') $badgeStyle = 'background: #d4edda; color: #155724; border: 1px solid #c3e6cb;';
                    if ($s == 'Cancelled') $badgeStyle = 'background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;';
                ?>
                <div class="invoice-status-badge" style="<?= $badgeStyle ?>">
                    <?= $s ?>
                </div>
            </div>

            <div class="invoice-info-grid">
                
                <div>
                    <span class="info-box-title">Billed To</span>
                    <h5 class="fw-bold mb-1"><?= htmlspecialchars($order['customer_name']) ?></h5>
                    <address class="customer-address mb-0">
                        <?= nl2br(htmlspecialchars($order['address'])) ?>
                    </address>
                </div>

                <div>
                    <span class="info-box-title">Manage Order Status</span>
                    <div class="status-update-container">
                        <form method="POST" class="d-flex gap-2">
                            <select name="status" class="form-select status-select-custom">
                                <option value="Pending" <?= $s == 'Pending' ? 'selected' : '' ?>>Pending</option>
                                <option value="Shipped" <?= $s == 'Shipped' ? 'selected' : '' ?>>Shipped</option>
                                <option value="Delivered" <?= $s == 'Delivered' ? 'selected' : '' ?>>Delivered</option>
                                <option value="Cancelled" <?= $s == 'Cancelled' ? 'selected' : '' ?>>Cancelled</option>
                            </select>
                            <button type="submit" name="update_status" class="btn btn-primary btn-sm px-3 rounded-pill">Update</button>
                        </form>
                        <small class="text-muted mt-2 d-block fst-italic">
                            * Updating status sends email notification (simulated).
                        </small>
                    </div>
                </div>

            </div>

            <div class="invoice-table-container">
                <table class="invoice-table">
                    <thead>
                        <tr>
                            <th width="50%">Item Description</th>
                            <th width="15%" class="text-center">Unit Price</th>
                            <th width="15%" class="text-center">Quantity</th>
                            <th width="20%" class="text-end">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($items as $item): ?>
                        <tr>
                            <td>
                                <div class="item-preview">
                                    <img src="assets/images/<?= $item['image'] ?: 'default.jpg' ?>" class="item-thumb" alt="img">
                                    <span class="item-name"><?= htmlspecialchars($item['name']) ?></span>
                                </div>
                            </td>
                            <td class="text-center text-muted">$<?= number_format($item['price'], 2) ?></td>
                            <td class="text-center fw-bold">x <?= $item['quantity'] ?></td>
                            <td class="text-end fw-bold">$<?= number_format($item['price'] * $item['quantity'], 2) ?></td>
                        </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            </div>

            <div class="invoice-footer">
                <div class="total-group">
                    <span class="total-label">Grand Total</span>
                    <span class="total-value-lg">$<?= number_format($order['total_amount'], 2) ?></span>
                </div>
            </div>

        </div>

    </div>

</body>
</html>


================================================
FILE: place_order.php
================================================
<?php
session_start();
include 'db.php';

if ($_SERVER['REQUEST_METHOD'] == 'POST' && !empty($_SESSION['cart'])) {
    
    $name = $_POST['customer_name'];
    $address = $_POST['address'];
    
    // 1. Calculate Total (With Discount Logic)
    $ids = implode(',', array_keys($_SESSION['cart']));
    $stmt = $pdo->query("SELECT * FROM products WHERE id IN ($ids)");
    $products = $stmt->fetchAll(PDO::FETCH_ASSOC);

    $subTotal = 0;
    foreach ($products as $p) {
        $subTotal += $p['price'] * $_SESSION['cart'][$p['id']];
    }

    // Apply Discount if exists
    $finalTotal = $subTotal;
    if (isset($_SESSION['discount'])) {
        $discountAmount = ($subTotal * $_SESSION['discount']['percent']) / 100;
        $finalTotal = $subTotal - $discountAmount;
    }

    try {
        // START TRANSACTION
        $pdo->beginTransaction();

        // 2. Insert into ORDERS table
        // Check if user is logged in
        $userId = isset($_SESSION['user_id']) ? $_SESSION['user_id'] : NULL;

        $sql = "INSERT INTO orders (customer_name, address, total_amount, status, user_id) VALUES (?, ?, ?, 'Pending', ?)";
        $stmt = $pdo->prepare($sql);
        
        // FIXED: We now use $finalTotal here instead of $total
        $stmt->execute([$name, $address, $finalTotal, $userId]);
        
        $orderId = $pdo->lastInsertId(); 

        // 3. Insert into ORDER_ITEMS table
        $sqlItem = "INSERT INTO order_items (order_id, product_id, quantity) VALUES (?, ?, ?)";
        $stmtItem = $pdo->prepare($sqlItem);

        // 4. Update Stock
        $sqlUpdateStock = "UPDATE products SET stock_qty = stock_qty - ? WHERE id = ?";
        $stmtStock = $pdo->prepare($sqlUpdateStock);

        foreach ($products as $p) {
            $qty = $_SESSION['cart'][$p['id']];

            // Save item
            $stmtItem->execute([$orderId, $p['id'], $qty]);
            
            // Decrease stock
            $stmtStock->execute([$qty, $p['id']]);
        }

        // Commit the transaction
        $pdo->commit();

        // 5. Clear Cart & Coupon
        unset($_SESSION['cart']);
        unset($_SESSION['discount']); // Clear the coupon so it doesn't apply to the next order automatically
        
        header("Location: success.php?orderid=$orderId");
        exit;

    } catch (Exception $e) {
        $pdo->rollBack();
        die("Order failed: " . $e->getMessage());
    }
} else {
    header("Location: index.php");
    exit;
}
?>


================================================
FILE: privacy_policy.php
================================================
<?php 
include 'db.php'; 
session_start();
include 'includes/header.php'; 
?>

<section class="legal-hero-modern">
    <div class="container">
        <span class="last-updated-badge">Last Updated: November 28, 2025</span>
        <h1 class="hero-display-text" style="font-size: 3.5rem;">Privacy Policy</h1>
        <p class="text-muted lead" style="max-width: 600px; margin: 0 auto;">
            We value your trust. Here is a clear breakdown of how we protect your data and respect your privacy at FreshCart.
        </p>
    </div>
</section>

<div class="container mb-5">
    <div class="legal-grid-layout">
        
        <aside>
            <div class="legal-toc-wrapper">
                <span class="legal-toc-title">Contents</span>
                <nav>
                    <a href="#intro" class="legal-nav-link"><i class="bi bi-info-circle"></i> Introduction</a>
                    <a href="#collection" class="legal-nav-link"><i class="bi bi-database"></i> Data Collection</a>
                    <a href="#usage" class="legal-nav-link"><i class="bi bi-check2-circle"></i> How We Use It</a>
                    <a href="#security" class="legal-nav-link"><i class="bi bi-shield-lock"></i> Security</a>
                    <a href="#contact" class="legal-nav-link"><i class="bi bi-envelope"></i> Contact Us</a>
                </nav>
            </div>
        </aside>

        <main class="policy-card-enhanced">
            
            <div id="intro" class="policy-section">
                <h2 class="policy-heading"><i class="bi bi-stars"></i> Introduction</h2>
                <p class="policy-text">
                    Welcome to FreshCart Market. We are committed to protecting your personal data and your right to privacy. 
                    When you visit our website <strong>freshcart.com</strong> ("Site"), and use our services, you trust us with your personal information. 
                    We take your privacy very seriously. In this privacy notice, we seek to explain to you in the clearest way possible what information we collect, how we use it, and what rights you have in relation to it.
                </p>
            </div>

            <div id="collection" class="policy-section">
                <h2 class="policy-heading"><i class="bi bi-person-vcard"></i> Information We Collect</h2>
                <p class="policy-text">We gather specific data to ensure your grocery delivery is accurate and timely. This includes:</p>
                
                <ul class="data-list">
                    <li>
                        <i class="bi bi-person-fill"></i>
                        <div>
                            <strong>Identity Data:</strong> Includes first name, last name, and username.
                        </div>
                    </li>
                    <li>
                        <i class="bi bi-geo-alt-fill"></i>
                        <div>
                            <strong>Delivery Data:</strong> Billing address and shipping address for fulfilling your orders.
                        </div>
                    </li>
                    <li>
                        <i class="bi bi-envelope-at-fill"></i>
                        <div>
                            <strong>Contact Data:</strong> Email address and telephone numbers.
                        </div>
                    </li>
                    <li>
                        <i class="bi bi-pc-display-horizontal"></i>
                        <div>
                            <strong>Technical Data:</strong> Internet protocol (IP) address, browser type and version, time zone setting and location.
                        </div>
                    </li>
                </ul>
            </div>

            <div id="usage" class="policy-section">
                <h2 class="policy-heading"><i class="bi bi-graph-up-arrow"></i> How We Use Your Data</h2>
                <p class="policy-text">
                    We process your information for purposes based on legitimate business interests, the fulfillment of our contract with you, and compliance with our legal obligations.
                </p>
                <p class="policy-text mt-3">
                    Specifically, we use it to:
                </p>
                <ul class="policy-text" style="padding-left: 20px; line-height: 2;">
                    <li>Facilitate account creation and logon process.</li>
                    <li>Fulfill and manage your orders, payments, and returns.</li>
                    <li>Send you administrative information (e.g., order updates).</li>
                    <li>Request feedback to improve your FreshCart experience.</li>
                </ul>
            </div>

            <div id="security" class="policy-section">
                <h2 class="policy-heading"><i class="bi bi-shield-check"></i> Security Measures</h2>
                <p class="policy-text">
                    We have implemented appropriate technical and organizational security measures designed to protect the security of any personal information we process. 
                    However, please also remember that we cannot guarantee that the internet itself is 100% secure. Although we will do our best to protect your personal information, transmission of personal information to and from our Site is at your own risk.
                </p>
            </div>

            <div id="contact" class="policy-section mb-0">
                <h2 class="policy-heading"><i class="bi bi-chat-square-heart"></i> Contact Us</h2>
                <p class="policy-text">
                    If you have questions or comments about this policy, you may email us or contact us by post:
                </p>
                
                <div class="contact-highlight-box">
                    <h5 class="mb-3">FreshCart Privacy Team</h5>
                    <p class="mb-1"><i class="bi bi-envelope me-2"></i> janusdominic0@gmail.com</p>
                    <p class="mb-0"><i class="bi bi-geo-alt me-2"></i> Maasin Zone 1-B, Zamboanga City</p>
                </div>
            </div>

        </main>
    </div>
</div>

<?php include 'includes/footer.php'; ?>


================================================
FILE: product.php
================================================
<?php
include 'db.php';
session_start();

$id = $_GET['id'] ?? null;
if (!$id) {
    header("Location: index.php");
    exit;
}

// 1. Handle Review Submission
$review_msg = '';
if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['submit_review'])) {
    if (!isset($_SESSION['user_id'])) {
        header("Location: user_login.php");
        exit;
    }
    
    $user_id = $_SESSION['user_id'];
    $rating = $_POST['rating'];
    $comment = $_POST['comment'];

    try {
        $stmtRev = $pdo->prepare("INSERT INTO reviews (product_id, user_id, rating, comment) VALUES (?, ?, ?, ?)");
        $stmtRev->execute([$id, $user_id, $rating, $comment]);
        $review_msg = "Review submitted successfully!";
    } catch (Exception $e) {
        $review_msg = "Error submitting review.";
    }
}

// 2. Fetch Product Details
$stmt = $pdo->prepare("SELECT * FROM products WHERE id = ?");
$stmt->execute([$id]);
$product = $stmt->fetch(PDO::FETCH_ASSOC);

if (!$product) {
    die("Product not found.");
}

// 3. Fetch Reviews
$stmtReviews = $pdo->prepare("SELECT reviews.*, users.full_name FROM reviews 
                              JOIN users ON reviews.user_id = users.id 
                              WHERE product_id = ? ORDER BY created_at DESC");
$stmtReviews->execute([$id]);
$reviews = $stmtReviews->fetchAll(PDO::FETCH_ASSOC);

// 4. Fetch Related Products
$stmtRelated = $pdo->prepare("SELECT * FROM products WHERE category = ? AND id != ? LIMIT 5");
$stmtRelated->execute([$product['category'], $id]);
$relatedProducts = $stmtRelated->fetchAll(PDO::FETCH_ASSOC);

// Calculate Average Rating
$avgRating = 0;
if (count($reviews) > 0) {
    $sum = 0;
    foreach ($reviews as $r) $sum += $r['rating'];
    $avgRating = round($sum / count($reviews), 1);
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <title><?= htmlspecialchars($product['name']) ?> | FreshCart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css?v=<?php echo time(); ?>">
</head>
<body class="container mt-5 mb-5">
    <a href="index.php" class="btn btn-outline-secondary rounded-pill mb-4 px-4">&larr; Back to Shop</a>

    <div class="product-showcase animate-fade-in">
        <div class="row align-items-center">
            <div class="col-lg-6 mb-4 mb-lg-0">
                <div class="product-image-stage">
                    <?php $img = $product['image'] ? $product['image'] : 'default.jpg'; ?>
                    <img src="assets/images/<?= $img ?>" alt="<?= htmlspecialchars($product['name']) ?>" id="mainImage">
                    
                    <div class="position-absolute bottom-0 start-0 p-4">
                        <span class="badge bg-white text-dark shadow-sm border rounded-pill px-3 py-2">
                            <i class="bi bi-arrows-angle-expand me-1"></i> Hover to Zoom
                        </span>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="product-details-panel">
                    <div class="product-breadcrumb">
                        Home / <?= htmlspecialchars($product['category']) ?>
                    </div>

                    <h1 class="product-title-large"><?= htmlspecialchars($product['name']) ?></h1>
                    
                    <div class="d-flex align-items-center mb-3">
                        <div class="text-warning me-2">
                            <?php 
                            for($i=1; $i<=5; $i++) {
                                if($i <= $avgRating) echo '<i class="bi bi-star-fill"></i>';
                                elseif($i - 0.5 <= $avgRating) echo '<i class="bi bi-star-half"></i>';
                                else echo '<i class="bi bi-star text-muted opacity-25"></i>';
                            } 
                            ?>
                        </div>
                        <span class="text-muted small">(<?= count($reviews) ?> reviews)</span>
                    </div>

                    <div class="product-price-large">
                        $<?= number_format($product['price'], 2) ?>
                        <?php if($product['stock_qty'] > 0): ?>
                            <span class="stock-badge"><i class="bi bi-check-circle-fill me-1"></i> In Stock</span>
                        <?php else: ?>
                            <span class="badge bg-danger rounded-pill px-3">Out of Stock</span>
                        <?php endif; ?>
                    </div>

                    <p class="text-muted lead mb-4">
                        Freshly sourced and carefully selected. Our <?= strtolower($product['name']) ?> is perfect for your daily needs, guaranteeing quality and taste in every bite.
                    </p>

                    <ul class="product-features">
                        <li><i class="bi bi-check2"></i> 100% Organic & Sustainably Sourced</li>
                        <li><i class="bi bi-check2"></i> Quality Checked for Freshness</li>
                        <li><i class="bi bi-check2"></i> Available for Express Delivery</li>
                    </ul>

                    <?php if ($product['stock_qty'] > 0): ?>
                        <form action="add_to_cart.php" method="POST" id="addToCartForm" class="mt-4">
                            <input type="hidden" name="product_id" value="<?= $product['id'] ?>">
                            <button type="submit" class="btn-add-large">
                                Add to Cart ‚Äî $<?= number_format($product['price'], 2) ?>
                            </button>
                        </form>
                    <?php else: ?>
                        <button class="btn btn-secondary w-100 py-3 rounded-pill mt-4" disabled>Currently Unavailable</button>
                    <?php endif; ?>

                </div>
            </div>
        </div>
    </div>

    <div class="product-lower-section mt-5">
        
        <div class="reviews-wrapper">
            <h3 class="mb-4" style="font-family: var(--font-serif);">Customer Feedback</h3>
            
            <?php if ($review_msg): ?>
                <div class="alert alert-success border-0 shadow-sm mb-4 rounded-3"><i class="bi bi-check-circle me-2"></i> <?= $review_msg ?></div>
            <?php endif; ?>

            <div class="review-form-card">
                <?php if (isset($_SESSION['user_id'])): ?>
                    <h5 class="mb-3">Share your experience</h5>
                    <form method="POST">
                        <div class="mb-3">
                            <label class="form-label small text-uppercase fw-bold text-muted">Your Rating</label>
                            <select name="rating" class="form-select border-0 bg-light rounded-pill w-auto px-4 fw-bold" required>
                                <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ Excellent</option>
                                <option value="4">‚òÖ‚òÖ‚òÖ‚òÖ Good</option>
                                <option value="3">‚òÖ‚òÖ‚òÖ Average</option>
                                <option value="2">‚òÖ‚òÖ Poor</option>
                                <option value="1">‚òÖ Terrible</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <textarea name="comment" class="form-control border-0 bg-light rounded-4 p-3" rows="3" placeholder="What did you like or dislike?" required></textarea>
                        </div>
                        <button type="submit" name="submit_review" class="btn btn-dark rounded-pill px-4">Post Review</button>
                    </form>
                <?php else: ?>
                    <div class="text-center py-2">
                        <p class="text-muted mb-3">Have you tried this product?</p>
                        <a href="user_login.php" class="btn btn-outline-dark rounded-pill px-4">Login to Review</a>
                    </div>
                <?php endif; ?>
            </div>

            <?php if (count($reviews) > 0): ?>
                <?php foreach ($reviews as $r): ?>
                    <div class="review-item">
                        <div class="review-header">
                            <div class="d-flex align-items-center gap-2">
                                <div class="bg-light rounded-circle d-flex align-items-center justify-content-center text-secondary fw-bold" style="width: 35px; height: 35px; font-size: 0.8rem;">
                                    <?= strtoupper(substr($r['full_name'], 0, 1)) ?>
                                </div>
                                <span class="reviewer-name"><?= htmlspecialchars($r['full_name']) ?></span>
                            </div>
                            <span class="review-date"><?= date('M d, Y', strtotime($r['created_at'])) ?></span>
                        </div>
                        
                        <div class="mb-2 text-warning" style="font-size: 0.8rem;">
                            <?php for($i=0; $i<$r['rating']; $i++) echo '<i class="bi bi-star-fill"></i> '; ?>
                        </div>
                        
                        <p class="review-body">"<?= htmlspecialchars($r['comment']) ?>"</p>
                    </div>
                <?php endforeach; ?>
            <?php else: ?>
                <div class="empty-reviews-state">
                    <i class="bi bi-chat-square-quote fs-1 opacity-25 mb-3 d-block"></i>
                    <p class="mb-0">No reviews yet. Be the first to share your thoughts!</p>
                </div>
            <?php endif; ?>
        </div>

        <div class="sidebar-wrapper">
            <h4 class="sidebar-title">You Might Also Like</h4>
            
            <div class="d-flex flex-column gap-2">
                <?php foreach ($relatedProducts as $rp): ?>
                    <?php $rImg = $rp['image'] ? $rp['image'] : 'default.jpg'; ?>
                    
                    <a href="product.php?id=<?= $rp['id'] ?>" class="text-decoration-none text-dark">
                        <div class="mini-product-card">
                            <div class="mini-img-box">
                                <img src="assets/images/<?= $rImg ?>" alt="<?= htmlspecialchars($rp['name']) ?>">
                            </div>
                            <div class="mini-details">
                                <span class="badge bg-light text-secondary border mb-1" style="font-size: 0.6rem;"><?= $rp['category'] ?></span>
                                <h6 class="text-truncate" style="max-width: 150px;"><?= htmlspecialchars($rp['name']) ?></h6>
                                <div class="mini-price">$<?= number_format($rp['price'], 2) ?></div>
                            </div>
                            <div class="ms-auto">
                                <button class="btn btn-sm btn-light rounded-circle border" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
                                    <i class="bi bi-arrow-right-short"></i>
                                </button>
                            </div>
                        </div>
                    </a>
                <?php endforeach; ?>
            </div>
        </div>

    </div>

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="liveToast" class="toast align-items-center text-bg-dark border-0 rounded-4 shadow-lg" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex p-2">
                <div class="toast-body d-flex align-items-center gap-2">
                    <i class="bi bi-bag-check-fill text-success fs-5"></i>
                    <span>Item added to cart!</span>
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('addToCartForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch('add_to_cart.php', { method: 'POST', body: formData })
            .then(res => res.json())
            .then(data => {
                if (data.status === 'success') {
                    const toast = new bootstrap.Toast(document.getElementById('liveToast'));
                    toast.show();
                } else if (data.status === 'login_required') {
                    window.location.href = 'user_login.php';
                } else {
                    alert(data.message);
                }
            });
        });
    </script>
</body>
</html>


================================================
FILE: profile.php
================================================
<?php
include 'db.php';
session_start();

if (!isset($_SESSION['user_id'])) {
    header("Location: user_login.php");
    exit;
}

$user_id = $_SESSION['user_id'];
$msg = "";

if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    $name = $_POST['full_name'];
    $address = $_POST['address'];
    
    if (!empty($_POST['password'])) {
        $pass = password_hash($_POST['password'], PASSWORD_DEFAULT);
        $sql = "UPDATE users SET full_name=?, address=?, password=? WHERE id=?";
        $stmt = $pdo->prepare($sql);
        $stmt->execute([$name, $address, $pass, $user_id]);
    } else {
        $sql = "UPDATE users SET full_name=?, address=? WHERE id=?";
        $stmt = $pdo->prepare($sql);
        $stmt->execute([$name, $address, $user_id]);
    }
    
    $_SESSION['user_name'] = $name;
    $msg = "Profile updated successfully!";
}

$stmt = $pdo->prepare("SELECT * FROM users WHERE id = ?");
$stmt->execute([$user_id]);
$user = $stmt->fetch(PDO::FETCH_ASSOC);
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <title>My Profile | FreshCart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css?v=<?php echo time(); ?>">
</head>
<body class="container mt-5">
    
    <a href="index.php" class="btn btn-outline-secondary mb-4">&larr; Back to Shop</a>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm border-0">
                <div class="card-body p-5">
                    
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="m-0" style="font-family: var(--font-serif);">Account Settings</h2>
                        
                        <div class="d-flex gap-2">
                            <a href="my_orders.php" class="btn btn-outline-primary btn-sm rounded-pill px-3">
                                <i class="bi bi-box-seam me-1"></i> Order History
                            </a>
                            <a href="user_logout.php" class="btn btn-outline-danger btn-sm rounded-pill px-3">
                                <i class="bi bi-box-arrow-right me-1"></i> Logout
                            </a>
                        </div>
                    </div>

                    <?php if ($msg): ?>
                        <div class="alert alert-success rounded-pill text-center mb-4"><?= $msg ?></div>
                    <?php endif; ?>

                    <form method="POST">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label text-muted small fw-bold">FULL NAME</label>
                                <input type="text" name="full_name" class="form-control bg-light" value="<?= htmlspecialchars($user['full_name']) ?>" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label text-muted small fw-bold">EMAIL (LOCKED)</label>
                                <input type="text" class="form-control bg-light" value="<?= htmlspecialchars($user['email']) ?>" disabled>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label text-muted small fw-bold">DELIVERY ADDRESS</label>
                            <textarea name="address" class="form-control bg-light" rows="3"><?= htmlspecialchars($user['address']) ?></textarea>
                        </div>

                        <div class="mb-4">
                            <label class="form-label text-muted small fw-bold">NEW PASSWORD <span class="fw-normal">(Leave blank to keep current)</span></label>
                            <input type="password" name="password" class="form-control bg-light" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>

                        <button type="submit" class="btn btn-primary w-100 rounded-pill py-2">Save Changes</button>
                    </form>

                </div>
            </div>
        </div>
    </div>

</body>
</html>


================================================
FILE: remove_from_cart.php
================================================
<?php
session_start();

if (isset($_POST['product_id'])) {
    $id = $_POST['product_id'];

    // Check if the item exists in the cart, then remove it
    if (isset($_SESSION['cart'][$id])) {
        unset($_SESSION['cart'][$id]);
    }
}

// Redirect back to the cart page immediately
header("Location: cart.php");
exit;
?>


================================================
FILE: success.php
================================================
<?php
include 'db.php';
session_start();

// 1. Validate Order ID existence
if (!isset($_GET['orderid'])) {
    header("Location: index.php");
    exit;
}

$order_id = $_GET['orderid'];

// 2. SECURE FETCH: Ensure the order belongs to the user OR the admin
if (isset($_SESSION['admin_logged_in']) && $_SESSION['admin_logged_in'] === true) {
    // Admin can view any order
    $stmt = $pdo->prepare("SELECT * FROM orders WHERE id = ?");
    $stmt->execute([$order_id]);
} else {
    // Customers can ONLY view their own orders
    // If user is not logged in, user_id is 0, which won't match any order
    $user_id = $_SESSION['user_id'] ?? 0; 
    
    $stmt = $pdo->prepare("SELECT * FROM orders WHERE id = ? AND user_id = ?");
    $stmt->execute([$order_id, $user_id]);
}

$order = $stmt->fetch(PDO::FETCH_ASSOC);

// 3. CRITICAL CHECK: If no order found (or doesn't belong to user), KICK THEM OUT
if (!$order) {
    header("Location: index.php");
    exit; // Stop script execution immediately
}

// Fetch items only after security check passes
$stmtItems = $pdo->prepare("SELECT order_items.*, products.name, products.price 
                            FROM order_items 
                            JOIN products ON order_items.product_id = products.id 
                            WHERE order_items.order_id = ?");
$stmtItems->execute([$order_id]);
$items = $stmtItems->fetchAll(PDO::FETCH_ASSOC);

include 'includes/header.php';
?>

<div class="success-page-wrapper">
    <div class="receipt-card">
        
        <div class="success-header-bg">
            <div class="success-icon-box">
                <i class="bi bi-check-lg"></i>
            </div>
            <h2 class="m-0" style="font-family: var(--font-serif);">Order Confirmed!</h2>
            <p class="opacity-75 mb-0">Thank you for shopping with FreshCart.</p>
        </div>

        <div class="receipt-body">
            
            <div class="receipt-meta">
                <p class="mb-1"><strong>Order #<?= str_pad($order['id'], 6, "0", STR_PAD_LEFT) ?></strong></p>
                <p class="mb-0"><?= date('F d, Y ‚Ä¢ h:i A', strtotime($order['created_at'])) ?></p>
            </div>

            <div class="text-center mb-4">
                <small class="text-muted text-uppercase fw-bold">Billed To</small>
                <h5 class="mb-1"><?= htmlspecialchars($order['customer_name']) ?></h5>
                <p class="text-muted small mb-0 px-4"><?= htmlspecialchars($order['address']) ?></p>
            </div>

            <div class="receipt-divider"></div>

            <div class="mb-4">
                <?php $subtotal = 0; ?>
                <?php foreach ($items as $item): ?>
                    <?php 
                        $lineTotal = $item['price'] * $item['quantity'];
                        $subtotal += $lineTotal;
                    ?>
                    <div class="receipt-item-row">
                        <div>
                            <span class="receipt-item-qty"><?= $item['quantity'] ?>x</span>
                            <?= htmlspecialchars($item['name']) ?>
                        </div>
                        <div class="fw-bold">$<?= number_format($lineTotal, 2) ?></div>
                    </div>
                <?php endforeach; ?>
            </div>

            <div class="receipt-divider"></div>

            <?php $discount = $subtotal - $order['total_amount']; ?>
            <?php if ($discount > 0): ?>
                <div class="receipt-item-row text-success">
                    <span>Discount Applied</span>
                    <span>-$<?= number_format($discount, 2) ?></span>
                </div>
            <?php endif; ?>

            <div class="receipt-total-row">
                <span class="total-label">Total Paid</span>
                <span class="total-amount">$<?= number_format($order['total_amount'], 2) ?></span>
            </div>

            <div class="mt-5 no-print">
                <button onclick="window.print()" class="btn-print">
                    <i class="bi bi-printer me-2"></i> Print Receipt
                </button>
                <a href="index.php" class="btn-continue d-block text-center text-decoration-none">
                    Continue Shopping
                </a>
            </div>

        </div>
    </div>
</div>

<?php include 'includes/footer.php'; ?>


================================================
FILE: sustainability.php
================================================
<?php 
include 'db.php'; 
session_start();
// Include Header
include 'includes/header.php'; 
?>

<section class="sus-hero">
    <div class="container">
        <span class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25 rounded-pill px-3 py-2 mb-3">Our Mission</span>
        <h1 class="sus-title animate-fade-in">Good for you.<br>Better for the planet.</h1>
        <p class="sus-lead">
            We believe that the food system shouldn't come at a cost to the earth. 
            From soil to doorstep, we are redefining what it means to be fresh.
        </p>
    </div>
</section>

<div class="container">
    
    <div class="row g-4 impact-grid">
        <div class="col-md-4">
            <div class="impact-card">
                <div class="impact-icon-bg">
                    <i class="bi bi-box-seam"></i>
                </div>
                <div class="impact-number">100%</div>
                <div class="impact-label">Plastic-Free Packaging</div>
                <p class="text-muted mt-3 small px-3">
                    Every box, bag, and container is compostable or recyclable. No single-use plastics, ever.
                </p>
            </div>
        </div>

        <div class="col-md-4">
            <div class="impact-card">
                <div class="impact-icon-bg">
                    <i class="bi bi-shop"></i>
                </div>
                <div class="impact-number">50+</div>
                <div class="impact-label">Local Farm Partners</div>
                <p class="text-muted mt-3 small px-3">
                    We source within 100 miles of your city, reducing travel time and supporting family farms.
                </p>
            </div>
        </div>

        <div class="col-md-4">
            <div class="impact-card">
                <div class="impact-icon-bg">
                    <i class="bi bi-recycle"></i>
                </div>
                <div class="impact-number">0%</div>
                <div class="impact-label">Food Waste in Transit</div>
                <p class="text-muted mt-3 small px-3">
                    Our AI-driven inventory means we only order what we sell. Nothing goes to the landfill.
                </p>
            </div>
        </div>
    </div>

    <div class="forest-section">
        <div class="row g-0 align-items-center">
            <div class="col-lg-6">
                <div class="forest-content">
                    <div class="d-flex align-items-center gap-2 mb-3 text-warning">
                        <i class="bi bi-lightning-charge-fill"></i>
                        <span class="text-uppercase small fw-bold tracking-wide">Vision 2026</span>
                    </div>
                    <h2 class="forest-title">Our Carbon Footprint Promise</h2>
                    <p class="forest-text">
                        We use electric vans for 90% of our city deliveries. We aren't just offsetting carbon; we are actively reducing it. 
                        By 2026, FreshCart aims to be the first grocery delivery service to be completely carbon neutral.
                    </p>
                    <a href="https://www.repsol.com/en/sustainability/sustainability-pillars/climate-change/reducing-carbon-footprint/index.cshtml" target="_blank" class="btn btn-light rounded-pill px-4 mt-4 text-success fw-bold">Read about Carbon Footprint</a>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="forest-img-side"></div>
            </div>
        </div>
    </div>

</div>

<?php include 'includes/footer.php'; ?>


================================================
FILE: terms_of_service.php
================================================
<?php 
include 'db.php'; 
session_start();
include 'includes/header.php'; 
?>

<section class="legal-hero-modern">
    <div class="container">
        <span class="last-updated-badge">Effective Date: November 28, 2025</span>
        <h1 class="hero-display-text" style="font-size: 3.5rem;">Terms of Service</h1>
        <p class="text-muted lead" style="max-width: 600px; margin: 0 auto;">
            Please read these terms carefully before using our service. They define the rules and regulations for the use of FreshCart Market.
        </p>
    </div>
</section>

<div class="container mb-5">
    <div class="legal-grid-layout">
        
        <aside>
            <div class="legal-toc-wrapper">
                <span class="legal-toc-title">Table of Contents</span>
                <nav>
                    <a href="#acceptance" class="legal-nav-link"><i class="bi bi-file-earmark-check"></i> Acceptance</a>
                    <a href="#accounts" class="legal-nav-link"><i class="bi bi-person-badge"></i> User Accounts</a>
                    <a href="#products" class="legal-nav-link"><i class="bi bi-basket"></i> Products & Pricing</a>
                    <a href="#orders" class="legal-nav-link"><i class="bi bi-credit-card"></i> Orders & Payment</a>
                    <a href="#returns" class="legal-nav-link"><i class="bi bi-arrow-counterclockwise"></i> Returns Policy</a>
                    <a href="#liability" class="legal-nav-link"><i class="bi bi-shield-exclamation"></i> Liability</a>
                </nav>
            </div>
        </aside>

        <main class="policy-card-enhanced">
            
            <div id="acceptance" class="policy-section">
                <h2 class="policy-heading"><i class="bi bi-check2-square"></i> 1. Acceptance of Terms</h2>
                <p class="policy-text">
                    By accessing and using the <strong>FreshCart Market</strong> website, you agree to comply with and be bound by these Terms of Service. 
                    These Terms apply to all visitors, users, and others who access or use the Service. If you disagree with any part of the terms, then you may not access the Service.
                </p>
            </div>

            <div id="accounts" class="policy-section">
                <h2 class="policy-heading"><i class="bi bi-person-lock"></i> 2. User Accounts</h2>
                <p class="policy-text">To access specific features like ordering and order tracking, you must create an account. You agree to:</p>
                
                <ul class="data-list">
                    <li>
                        <i class="bi bi-shield-check"></i>
                        <div>
                            <strong>Security:</strong> Maintain the confidentiality of your password and accept responsibility for all activities that occur under your account.
                        </div>
                    </li>
                    <li>
                        <i class="bi bi-pencil-square"></i>
                        <div>
                            <strong>Accuracy:</strong> Provide accurate, current, and complete information during the registration process.
                        </div>
                    </li>
                    <li>
                        <i class="bi bi-exclamation-circle"></i>
                        <div>
                            <strong>Notification:</strong> Notify us immediately of any unauthorized use of your account or any other breach of security.
                        </div>
                    </li>
                </ul>
            </div>

            <div id="products" class="policy-section">
                <h2 class="policy-heading"><i class="bi bi-tag"></i> 3. Products and Pricing</h2>
                <p class="policy-text">
                    We strive to ensure that all details, descriptions, and prices of products appearing on FreshCart are accurate. However, errors may occur.
                </p>
                <ul class="policy-text mt-3" style="padding-left: 20px; line-height: 2;">
                    <li><strong>Freshness Guarantee:</strong> Due to the nature of organic produce, items may vary slightly in size, color, and weight from images.</li>
                    <li><strong>Availability:</strong> All products are subject to availability. We reserve the right to limit quantities.</li>
                    <li><strong>Pricing:</strong> Prices are subject to change without notice. If we discover an error in the price of goods you have ordered, we will inform you ASAP.</li>
                </ul>
            </div>

            <div id="orders" class="policy-section">
                <h2 class="policy-heading"><i class="bi bi-wallet2"></i> 4. Orders and Payments</h2>
                <p class="policy-text">
                    By placing an order, you are offering to purchase a product subject to these terms. All orders are subject to availability and confirmation of the order price.
                </p>
                <div class="p-3 bg-light rounded-3 mt-3 border">
                    <strong>Payment Methods:</strong> We currently accept Cash on Delivery (COD). Online payment gateways (Credit Card/GCash) will be implemented in future updates.
                </div>
            </div>

            <div id="returns" class="policy-section">
                <h2 class="policy-heading"><i class="bi bi-box-seam"></i> 5. Returns and Refunds</h2>
                <p class="policy-text">
                    Due to the perishable nature of our goods (fruits, vegetables, dairy), we have a specific policy:
                </p>
                <ul class="data-list">
                    <li>
                        <i class="bi bi-flower1"></i>
                        <div>
                            <strong>Perishables:</strong> If you receive damaged or spoiled items, please contact us within 24 hours of delivery with photos for a refund.
                        </div>
                    </li>
                    <li>
                        <i class="bi bi-box"></i>
                        <div>
                            <strong>Non-Perishables:</strong> Unopened pantry items may be returned within 7 days of purchase in their original packaging.
                        </div>
                    </li>
                </ul>
            </div>

            <div id="liability" class="policy-section mb-0">
                <h2 class="policy-heading"><i class="bi bi-shield-exclamation"></i> 6. Limitation of Liability</h2>
                <p class="policy-text">
                    In no event shall FreshCart Market, nor its directors, employees, partners, agents, suppliers, or affiliates, be liable for any indirect, incidental, special, consequential or punitive damages, including without limitation, loss of profits, data, use, goodwill, or other intangible losses, resulting from your access to or use of or inability to access or use the Service.
                </p>
            </div>

        </main>
    </div>
</div>

<?php include 'includes/footer.php'; ?>


================================================
FILE: update_cart.php
================================================
<?php
session_start();
include 'db.php';

if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['product_id'], $_POST['action'])) {
    $id = $_POST['product_id'];
    $action = $_POST['action'];
    
    if (!isset($_SESSION['cart'][$id])) {
        header("Location: cart.php");
        exit;
    }

    // Check Stock Limit First
    $stmt = $pdo->prepare("SELECT stock_qty FROM products WHERE id = ?");
    $stmt->execute([$id]);
    $product = $stmt->fetch();

    if ($action == 'increase') {
        if ($_SESSION['cart'][$id] < $product['stock_qty']) {
            $_SESSION['cart'][$id]++;
        }
    } elseif ($action == 'decrease') {
        if ($_SESSION['cart'][$id] > 1) {
            $_SESSION['cart'][$id]--;
        } else {
            unset($_SESSION['cart'][$id]); // Remove if decreasing from 1
        }
    }
}
header("Location: cart.php");
exit;
?>


================================================
FILE: user_cancel_order.php
================================================
<?php
include 'db.php';
session_start();

// 1. Security Check: Must be logged in
if (!isset($_SESSION['user_id'])) {
    header("Location: user_login.php");
    exit;
}

if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['order_id'])) {
    $order_id = $_POST['order_id'];
    $user_id = $_SESSION['user_id']; // Get the logged-in user ID

    try {
        $pdo->beginTransaction();

        // 2. Get current status AND verify ownership (The Fix)
        // We added "AND user_id = ?" to ensure you own this order
        $stmt = $pdo->prepare("SELECT status FROM orders WHERE id = ? AND user_id = ?");
        $stmt->execute([$order_id, $user_id]);
        $order = $stmt->fetch(PDO::FETCH_ASSOC);

        if ($order && $order['status'] != 'Cancelled') {
            
            // 3. RESTOCK ITEMS
            $stmtItems = $pdo->prepare("SELECT product_id, quantity FROM order_items WHERE order_id = ?");
            $stmtItems->execute([$order_id]);
            $items = $stmtItems->fetchAll(PDO::FETCH_ASSOC);

            $stmtRestock = $pdo->prepare("UPDATE products SET stock_qty = stock_qty + ? WHERE id = ?");
            foreach ($items as $item) {
                $stmtRestock->execute([$item['quantity'], $item['product_id']]);
            }

            // 4. Update Status (Verify ownership again for safety)
            $stmtUpdate = $pdo->prepare("UPDATE orders SET status = 'Cancelled' WHERE id = ? AND user_id = ?");
            $stmtUpdate->execute([$order_id, $user_id]);

            $pdo->commit();
            
            header("Location: my_orders.php?msg=cancelled");
            exit;

        } else {
            // Order not found, not yours, or already cancelled
            $pdo->rollBack();
            header("Location: my_orders.php?error=invalid_request");
            exit;
        }

    } catch (Exception $e) {
        $pdo->rollBack();
        die("Error: " . $e->getMessage());
    }
} else {
    header("Location: my_orders.php");
    exit;
}
?>


================================================
FILE: user_login.php
================================================
<?php
include 'db.php';
session_start();

$error_message = '';
if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    $email = $_POST['email'];
    $password = $_POST['password'];
    
    $stmt = $pdo->prepare("SELECT * FROM users WHERE email = ?");
    $stmt->execute([$email]);
    $user = $stmt->fetch(PDO::FETCH_ASSOC);

    if ($user && password_verify($password, $user['password'])) {
        $_SESSION['user_id'] = $user['id'];
        $_SESSION['user_name'] = $user['full_name'];
        header("Location: index.php");
        exit;
    } else {
        $error_message = "Invalid email or password!";
    }
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - FreshCart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css?v=<?php echo time(); ?>">
</head>
<body>

    <div class="auth-wrapper">
        <div class="row g-0 h-100">
            
            <div class="col-lg-6 d-none d-lg-block">
                <div class="auth-banner-side login-bg">
                    <div class="auth-banner-content">
                        <h1 style="font-family: var(--font-serif);font-size: 3rem;margin-bottom: 1.5rem;line-height: 1.1; color: #fff; opacity: 0.9;" >Quality you can taste, aesthetics you can feel.</h1>
                        <p class="fs-5 opacity-75">Welcome back to your curated grocery experience.</p>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="auth-form-side">
                    <div class="hero-blob blob-2" style="width: 200px; height: 200px; top: -50px; right: -50px; opacity: 0.4;"></div>

                    <div class="auth-form-container">
                        <div class="text-center mb-5">
                            <h2 class="mb-2" style="font-family: var(--font-serif); font-size: 2.5rem;">Welcome Back</h2>
                            <p class="text-muted">Please enter your details to sign in.</p>
                        </div>

                        <?php if ($error_message): ?>
                            <div class="alert alert-danger border-0 shadow-sm rounded-4 mb-4 text-center">
                                <i class="bi bi-exclamation-triangle-fill me-2"></i> <?= $error_message ?>
                            </div>
                        <?php endif; ?>

                        <form action="user_login.php" method="POST">
                            
                            <div class="mb-2">
                                <label class="auth-label">Email Address</label>
                                <div class="auth-input-group">
                                    <i class="bi bi-envelope"></i>
                                    <input type="email" name="email" placeholder="you@example.com" required>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="auth-label">Password</label>
                                <div class="auth-input-group">
                                    <i class="bi bi-lock"></i>
                                    <input type="password" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-auth w-100 py-3 mb-4 shadow">Sign In</button>

                            <div class="text-center d-flex flex-column gap-2">
                                <span class="text-muted">Don't have an account? <a href="user_register.php" class="text-dark fw-bold text-decoration-underline">Create one</a></span>
                                <a href="index.php" class="text-muted small text-decoration-none mt-2">‚Üê Back to Shop</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </div>
    </div>

</body>
</html>


================================================
FILE: user_logout.php
================================================
<?php
session_start();
unset($_SESSION['user_id']);
unset($_SESSION['user_name']);
header("Location: index.php");
exit;
?>


================================================
FILE: user_order_details.php
================================================
<?php
include 'db.php';
session_start();

// 1. Security Check
if (!isset($_SESSION['user_id'])) {
    header("Location: user_login.php");
    exit;
}

if (!isset($_GET['order_id'])) {
    header("Location: my_orders.php");
    exit;
}

$order_id = $_GET['order_id'];
$user_id = $_SESSION['user_id'];

// 2. Fetch Order (Verify it belongs to this user!)
$stmt = $pdo->prepare("SELECT * FROM orders WHERE id = ? AND user_id = ?");
$stmt->execute([$order_id, $user_id]);
$order = $stmt->fetch(PDO::FETCH_ASSOC);

if (!$order) {
    header("Location: my_orders.php");
    exit;
}

// 3. Fetch Items
$stmtItems = $pdo->prepare("SELECT order_items.*, products.name, products.price, products.image 
                            FROM order_items 
                            JOIN products ON order_items.product_id = products.id 
                            WHERE order_items.order_id = ?");
$stmtItems->execute([$order_id]);
$items = $stmtItems->fetchAll(PDO::FETCH_ASSOC);

include 'includes/header.php';

// Status Logic for UI
$s = $order['status'];
$badgeClass = 'ts-pending';
$icon = 'bi-hourglass-split';
$progressWidth = '5%'; // Default for pending

if ($s == 'Shipped') { 
    $badgeClass = 'ts-shipped'; 
    $icon = 'bi-truck';
    $progressWidth = '50%';
}
if ($s == 'Delivered') { 
    $badgeClass = 'ts-delivered'; 
    $icon = 'bi-check-circle-fill'; 
    $progressWidth = '100%';
}
if ($s == 'Cancelled') { 
    $badgeClass = 'ts-cancelled'; 
    $icon = 'bi-x-circle-fill'; 
    $progressWidth = '0%'; // Hide progress for cancelled
}
?>

<div class="container mt-5 mb-5 order-ticket-wrapper">
    
    <div class="mb-4 animate-fade-in">
        <a href="my_orders.php" class="text-decoration-none text-muted small fw-bold text-uppercase">
            <i class="bi bi-arrow-left me-1"></i> Back to Order History
        </a>
    </div>

    <div class="order-ticket-card animate-fade-in">
        
        <div class="ticket-header">
            <div>
                <h1 class="ticket-id">Order #<?= str_pad($order['id'], 5, '0', STR_PAD_LEFT) ?></h1>
                <div class="ticket-meta">
                    <span><i class="bi bi-calendar3 me-1"></i> <?= date('M d, Y', strtotime($order['created_at'])) ?></span>
                    <span><i class="bi bi-clock me-1"></i> <?= date('h:i A', strtotime($order['created_at'])) ?></span>
                </div>
            </div>
            <div class="ticket-status-badge <?= $badgeClass ?>">
                <i class="bi <?= $icon ?>"></i> <?= $s ?>
            </div>
        </div>

        <?php if ($s != 'Cancelled'): ?>
        <div class="order-progress-wrapper pt-4">
            <div class="progress-track">
                <div class="progress-fill" style="width: <?= $progressWidth ?>;"></div>
                
                <div class="progress-step active">
                    <span class="step-label">Ordered</span>
                </div>
                
                <div class="progress-step <?= ($s == 'Shipped' || $s == 'Delivered') ? 'active' : '' ?>">
                    <span class="step-label">Shipped</span>
                </div>
                
                <div class="progress-step <?= ($s == 'Delivered') ? 'active' : '' ?>">
                    <span class="step-label">Delivered</span>
                </div>
            </div>
        </div>
        <?php endif; ?>

        <div class="ticket-info-grid">
            <div>
                <span class="info-label">Delivered To</span>
                <div class="info-content">
                    <strong><?= htmlspecialchars($order['customer_name']) ?></strong><br>
                    <?= nl2br(htmlspecialchars($order['address'])) ?>
                </div>
            </div>
            <div>
                <span class="info-label">Payment Method</span>
                <div class="info-content">
                    <i class="bi bi-cash-stack text-success me-2"></i> Cash on Delivery
                </div>
            </div>
        </div>

        <div class="ticket-items-container">
            <span class="info-label mb-3">Items Ordered</span>
            
            <?php foreach ($items as $item): ?>
                <div class="ticket-item">
                    <img src="assets/images/<?= $item['image'] ?: 'default.jpg' ?>" class="ticket-thumb" alt="Product">
                    <div class="ticket-item-details">
                        <span class="item-name"><?= htmlspecialchars($item['name']) ?></span>
                        <span class="item-qty">Qty: <?= $item['quantity'] ?></span>
                    </div>
                    <div class="item-price">
                        $<?= number_format($item['price'] * $item['quantity'], 2) ?>
                    </div>
                </div>
            <?php endforeach; ?>
        </div>

        <div class="ticket-footer">
            <span class="ticket-total-label">Grand Total</span>
            <span class="ticket-total-value">$<?= number_format($order['total_amount'], 2) ?></span>
        </div>

        <?php if ($s == 'Pending'): ?>
            <div class="p-4 text-center bg-light border-top">
                <form action="user_cancel_order.php" method="POST" onsubmit="return confirm('Are you sure you want to cancel this order?');">
                    <input type="hidden" name="order_id" value="<?= $order['id'] ?>">
                    <button type="submit" class="btn btn-outline-danger rounded-pill px-4 text-uppercase small fw-bold">
                        Cancel Order
                    </button>
                </form>
                <p class="text-muted small mt-2 mb-0">You can only cancel orders before they are shipped.</p>
            </div>
        <?php endif; ?>

    </div>
    
    <div class="text-center mt-4">
        <a href="contact.php" class="text-muted small text-decoration-none">Need help with this order? Contact Support</a>
    </div>

</div>

<?php include 'includes/footer.php'; ?>


================================================
FILE: user_register.php
================================================
<?php
include 'db.php';
session_start();

$error = '';
$success = '';

if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    $name = $_POST['full_name'];
    $email = $_POST['email'];
    $password = $_POST['password'];
    $address = $_POST['address'];

    $stmt = $pdo->prepare("SELECT id FROM users WHERE email = ?");
    $stmt->execute([$email]);
    if ($stmt->fetch()) {
        $error = "Email is already registered!";
    } else {
        $hashed_password = password_hash($password, PASSWORD_DEFAULT);
        $sql = "INSERT INTO users (full_name, email, password, address) VALUES (?, ?, ?, ?)";
        $stmt = $pdo->prepare($sql);
        if ($stmt->execute([$name, $email, $hashed_password, $address])) {
            $success = "Account created successfully!";
            echo "<script>setTimeout(function(){ window.location.href = 'user_login.php'; }, 2000);</script>";
        } else {
            $error = "Registration failed.";
        }
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - FreshCart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css?v=<?php echo time(); ?>">
</head>
<body>

    <div class="auth-wrapper">
        <div class="row g-0 h-100">
            
            <div class="col-lg-6 d-none d-lg-block">
                <div class="auth-banner-side register-bg">
                    <div class="auth-banner-content">
                        <h1 style="font-family: var(--font-serif);font-size: 3rem;margin-bottom: 1.5rem;line-height: 1.1; color: #fff; opacity: 0.9;" >Join the community of clean, fresh food lovers.</h1>
                        <p class="fs-5 opacity-75">Track orders, save favorites, and get many exclusive organic deals.</p>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="auth-form-side">
                    <div class="hero-blob blob-1" style="width: 250px; height: 250px; bottom: -50px; left: -50px; opacity: 0.4;"></div>

                    <div class="auth-form-container">
                        <div class="text-center mb-4">
                            <h2 class="mb-2" style="font-family: var(--font-serif); font-size: 2.5rem;">Create Account</h2>
                            <p class="text-muted">It only takes a minute to join.</p>
                        </div>

                        <?php if ($error): ?>
                            <div class="alert alert-danger border-0 shadow-sm rounded-4 mb-4 text-center">
                                <?= $error ?>
                            </div>
                        <?php endif; ?>
                        <?php if ($success): ?>
                            <div class="alert alert-success border-0 shadow-sm rounded-4 mb-4 text-center">
                                <i class="bi bi-check-circle-fill me-2"></i> <?= $success ?>
                            </div>
                        <?php endif; ?>

                        <form method="POST">
                            <div class="mb-2">
                                <label class="auth-label">Full Name</label>
                                <div class="auth-input-group">
                                    <i class="bi bi-person"></i>
                                    <input type="text" name="full_name" placeholder="John Doe" required>
                                </div>
                            </div>

                            <div class="mb-2">
                                <label class="auth-label">Email Address</label>
                                <div class="auth-input-group">
                                    <i class="bi bi-envelope"></i>
                                    <input type="email" name="email" placeholder="you@example.com" required>
                                </div>
                            </div>

                            <div class="mb-2">
                                <label class="auth-label">Password</label>
                                <div class="auth-input-group">
                                    <i class="bi bi-lock"></i>
                                    <input type="password" name="password" placeholder="Create a strong password" required>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="auth-label">Delivery Address (Optional)</label>
                                <div class="auth-input-group">
                                    <i class="bi bi-geo-alt"></i>
                                    <input type="text" name="address" placeholder="123 Main St, City">
                                </div>
                            </div>

                            <button type="submit" class="btn btn-auth w-100 py-3 mb-4 shadow">Register Now</button>

                            <div class="text-center d-flex flex-column gap-2">
                                <span class="text-muted">Already have an account? <a href="user_login.php" class="text-dark fw-bold text-decoration-underline">Login</a></span>
                                <a href="index.php" class="text-muted small text-decoration-none mt-2">‚Üê Back to Shop</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </div>
    </div>

</body>
</html>


================================================
FILE: includes/footer.php
================================================
    <footer class="site-footer">
        <div class="container">
            <div class="row g-5">
                
                <div class="col-lg-4 col-md-6">
                    <a href="index.php" class="text-decoration-none">
                        <span class="footer-brand">FreshCart<span style="color: var(--accent-color)">.</span></span>
                    </a>
                    <p class="text-muted small lh-lg mb-4">
                        Delivering nature's best to your doorstep. We partner directly with local organic farmers to ensure freshness, sustainability, and fair trade practices.
                    </p>
                    <div class="d-flex">
                        <a href="https://www.facebook.com/notagirlgamer69" target="_blank" class="social-icon-link"><i class="bi bi-facebook"></i></a>
                        <a href="https://www.instagram.com/janusinss/" target="_blank" class="social-icon-link"><i class="bi bi-instagram"></i></a>
                        <a href="https://x.com/Syrupynut" target="_blank" class="social-icon-link"><i class="bi bi-twitter"></i></a>
                        <a href="https://www.linkedin.com/in/janusdominic/" target="_blank" class="social-icon-link"><i class="bi bi-linkedin"></i></a>
                    </div>
                </div>

                <div class="col-lg-2 col-md-3 col-6">
                    <h6 class="footer-heading">Shop</h6>
                    <ul class="list-unstyled footer-link-list">
                        <li><a href="index.php" class="footer-link">All Products</a></li>
                        <li><a href="index.php" class="footer-link">Fresh Produce</a></li>
                        <li><a href="index.php" class="footer-link">Dairy & Eggs</a></li>
                        <li><a href="index.php" class="footer-link">Bakery</a></li>
                    </ul>
                </div>

                <div class="col-lg-2 col-md-3 col-6">
                    <h6 class="footer-heading">Company</h6>
                    <ul class="list-unstyled footer-link-list">
                        <li><a href="about.php" class="footer-link">About Us</a></li>
                        <li><a href="sustainability.php" class="footer-link">Sustainability</a></li>
                        <li><a href="farmers.php" class="footer-link">Farmers</a></li>
                        <li><a href="contact.php" class="footer-link">Contact</a></li>
                    </ul>
                </div>

                <div class="col-lg-4 col-md-12">
                    <h6 class="footer-heading">Stay Fresh</h6>
                    <p class="small text-muted mb-3">Join our newsletter for exclusive organic deals and recipes.</p>
                    
                    <form action="#">
                        <div class="footer-newsletter-group">
                            <input type="email" class="footer-email-input" placeholder="Your email address">
                            <button class="footer-subscribe-btn" type="button">Join</button>
                        </div>
                    </form>

                    <div class="mt-4">
                        <p class="small text-muted mb-2">Secure Payment</p>
                        <div class="d-flex flex-wrap">
                            <span class="payment-badge">VISA</span>
                            <span class="payment-badge">MasterCard</span>
                            <span class="payment-badge">PayPal</span>
                            <span class="payment-badge">GCash</span>
                        </div>
                    </div>
                </div>

            </div>

            <div class="border-top mt-5 pt-4 d-flex flex-column flex-md-row justify-content-between align-items-center">
                <small class="text-muted mb-2 mb-md-0">&copy; 2025 FreshCart Market. Student Project by Janus Dominic.</small>
                <div class="small text-muted">
                    <a href="privacy_policy.php" class="text-decoration-none text-muted fw-bold me-3">Privacy Policy</a>
                    <a href="terms_of_service.php" class="text-decoration-none text-muted fw-bold">Terms of Service</a>
                </div>
            </div>
        </div>
    </footer>

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="liveToast" class="toast align-items-center text-bg-dark border-0 rounded-4 shadow-lg" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex p-2">
                <div class="toast-body d-flex align-items-center gap-2">
                    <i class="bi bi-bag-check-fill text-success fs-5"></i>
                    <span>Item added to cart!</span>
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global AJAX Add to Cart (Works on every page)
        document.addEventListener('submit', function(e) {
            if (e.target && e.target.classList.contains('add-cart-form')) {
                e.preventDefault();
                const formData = new FormData(e.target);
                fetch('add_to_cart.php', { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        const badge = document.getElementById('cart-badge');
                        if (badge) badge.innerText = data.cart_count;
                        else location.reload();
                        const toast = new bootstrap.Toast(document.getElementById('liveToast'));
                        toast.show();
                    } else if (data.status === 'login_required') {
                        window.location.href = 'user_login.php';
                    } else {
                        alert(data.message);
                    }
                });
            }
        });
    </script>
</body>
</html>


================================================
FILE: includes/header.php
================================================
<?php
// Fix session error: Check if session is already active
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

// Calculate Cart Count safely
$cartCount = isset($_SESSION['cart']) ? array_sum($_SESSION['cart']) : 0;
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <title>FreshCart Market</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css?v=<?php echo time(); ?>">
</head>
<body>

    <div class="bg-dark text-white text-center py-2 small fw-bold" style="letter-spacing: 0.05em;">
        ‚ö° FLASH SALE: Use code <span class="text-warning border-bottom border-warning" style="cursor:pointer;" onclick="navigator.clipboard.writeText('FRESH50'); alert('Code FRESH50 copied!');">FRESH50</span> for 50% OFF your first order!
    </div>

    <nav class="navbar navbar-expand-lg navbar-glass sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.php">
                <h3 class="m-0" style="font-family: var(--font-serif); letter-spacing: -0.05em; font-weight: 800;">
                    FreshCart<span style="color: var(--accent-color)">.</span>
                </h3>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navContent">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navContent">
                <ul class="navbar-nav ms-auto align-items-center gap-3">
                    <?php if (isset($_SESSION['user_id'])): ?>
                        <li class="nav-item">
                            <a class="nav-link-custom d-flex align-items-center gap-2" href="profile.php">
                                <div class="bg-dark text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; font-size: 0.8rem;">
                                    <?= strtoupper(substr($_SESSION['user_name'], 0, 1)) ?>
                                </div>
                                <span><?= htmlspecialchars($_SESSION['user_name']) ?></span>
                            </a>
                        </li>
                    <?php else: ?>
                        <li class="nav-item"><a href="user_login.php" class="nav-link-custom">Login</a></li>
                        <li class="nav-item"><a href="user_register.php" class="btn btn-primary rounded-pill px-4 shadow-sm">Sign Up</a></li>
                    <?php endif; ?>

                    <li class="nav-item position-relative">
                        <a href="cart.php" class="btn btn-outline-secondary border-0 position-relative">
                            <i class="bi bi-bag" style="font-size: 1.3rem;"></i>
                            <?php if($cartCount > 0): ?>
                                <span id="cart-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger border border-light" style="font-size: 0.65rem;">
                                    <?= $cartCount ?>
                                </span>
                            <?php endif; ?>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

